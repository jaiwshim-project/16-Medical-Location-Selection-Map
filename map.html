<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë´íŠ¸ë§µAI ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„ â€” ì§€ë„ íƒìƒ‰</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>tailwind.config={theme:{extend:{fontFamily:{sans:['Pretendard Variable','Pretendard','system-ui','sans-serif']}}}}</script>
<style>
html{scroll-behavior:smooth}
body{font-family:'Pretendard Variable','Pretendard',system-ui,sans-serif;margin:0;overflow:hidden}
@keyframes marker-pulse{0%,100%{box-shadow:0 0 0 0 rgba(245,158,11,0.5)}70%{box-shadow:0 0 0 12px rgba(245,158,11,0)}}
.leaflet-container{font-family:'Pretendard Variable',sans-serif;z-index:0}
.clinic-tooltip{background:white;border:1px solid #e5e7eb;border-radius:6px;padding:2px 8px;font-size:11px;font-weight:600;color:#1f2937;box-shadow:0 1px 4px rgba(0,0,0,0.12);white-space:nowrap}
.clinic-tooltip::before{border-right-color:#e5e7eb!important}
.rec-tooltip{background:#fffbeb;border:1px solid #fbbf24;border-radius:6px;padding:2px 8px;font-size:11px;font-weight:700;color:#92400e;box-shadow:0 1px 4px rgba(0,0,0,0.12)}
.rec-tooltip::before{border-right-color:#fbbf24!important}
#map-list::-webkit-scrollbar{width:6px}#map-list::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:6px}
.map-clinic-card{transition:background 0.15s}.map-clinic-card:hover{background:#eff6ff}
.map-clinic-card.active{background:#eff6ff;border-left:3px solid #3b82f6}
.map-legend{background:white;border-radius:10px;box-shadow:0 2px 12px rgba(0,0,0,0.15);padding:0;font-size:12px;line-height:1.6;max-width:200px;color:#374151;overflow:hidden}
.map-legend h4{font-size:12px;font-weight:700;margin:0;color:#111827;padding:8px 12px;background:#f9fafb;border-bottom:1px solid #e5e7eb;cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none}
.map-legend h4 .leg-arrow{transition:transform 0.2s;font-size:10px}
.map-legend.collapsed h4 .leg-arrow{transform:rotate(-90deg)}
.map-legend .leg-body{max-height:320px;overflow-y:auto;padding:8px 12px 10px;scrollbar-width:thin}
.map-legend .leg-body::-webkit-scrollbar{width:4px}
.map-legend .leg-body::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}
.map-legend .leg-section{margin-top:6px;padding-top:5px;border-top:1px solid #f3f4f6}
.map-legend .leg-section:first-of-type{margin-top:0;padding-top:0;border-top:none}
.map-legend .leg-title{font-size:10px;font-weight:700;color:#6b7280;letter-spacing:0.5px;margin-bottom:3px}
.map-legend .leg-row{display:flex;align-items:center;gap:5px;margin:1px 0;font-size:11px}
.map-legend .leg-dot{width:10px;height:10px;border-radius:50%;border:1.5px solid white;box-shadow:0 1px 2px rgba(0,0,0,0.2);flex-shrink:0}
.map-legend .leg-badge{padding:0px 5px;border-radius:3px;font-size:9px;font-weight:600;flex-shrink:0}
.map-legend.collapsed .leg-body{display:none}
</style>
</head>
<body class="antialiased bg-white text-gray-900">

<!-- HEADER -->
<header class="sticky top-0 z-50 bg-sky-100/90 backdrop-blur border-b border-sky-200">
<div class="max-w-full mx-auto px-6 h-16 flex items-center justify-between">
<a href="index.html" class="flex items-center gap-2"><div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center"><span class="text-white font-bold text-sm">D</span></div><span class="font-bold text-lg text-blue-900">ë´íŠ¸ë§µAI <span class="text-base font-semibold text-blue-600">ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„</span></span></a>
<nav class="hidden md:flex items-center gap-8">
<a href="analysis.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">ì…ì§€ë¶„ì„</a>
<span class="text-sm text-blue-600 font-semibold border-b-2 border-blue-600 pb-0.5">ì§€ë„ íƒìƒ‰</span>
<a href="pricing.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">ìš”ê¸ˆì œ</a>
<a href="reports.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">ë¦¬í¬íŠ¸</a>
<a href="promo.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">í™ë³´</a>
<a href="faq.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">FAQ</a>
<a href="manual.html" class="text-sm font-medium text-blue-800 hover:text-blue-950 transition">ì‚¬ìš©ì ë§¤ë‰´ì–¼</a>
</nav>
<button class="md:hidden p-2 text-blue-800" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
</div>
<div id="mobile-menu" class="hidden md:hidden border-t border-sky-200 bg-sky-50 px-6 py-4 space-y-3">
<a href="analysis.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">ì…ì§€ë¶„ì„</a>
<span class="block text-blue-600 font-semibold py-2">ì§€ë„ íƒìƒ‰</span>
<a href="pricing.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">ìš”ê¸ˆì œ</a>
<a href="reports.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">ë¦¬í¬íŠ¸</a>
<a href="promo.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">í™ë³´</a>
<a href="faq.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">FAQ</a>
<a href="manual.html" class="block text-blue-800 font-medium py-2" onclick="closeMobile()">ì‚¬ìš©ì ë§¤ë‰´ì–¼</a>
</div>
</header>

<!-- MAP LAYOUT -->
<div style="height:calc(100vh - 4rem)" class="flex">
<!-- Left Panel -->
<div class="w-[380px] shrink-0 border-r border-gray-200 flex flex-col bg-white relative z-10 shadow-lg" id="map-left-panel">
<div class="p-3 border-b border-gray-100">
<div class="relative"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
<input type="search" id="map-search" placeholder="ì ì‹¤ ì¹˜ê³¼, ê°•ë‚¨êµ¬, íŒêµ..." class="w-full pl-9 pr-8 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none" oninput="onMapSearch()">
<button onclick="document.getElementById('map-search').value='';onMapSearch()" class="absolute right-2.5 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 text-lg leading-none">&times;</button></div>
<div class="flex gap-1.5 mt-2 flex-wrap" id="map-filters"></div>
</div>
<div class="px-3 py-2 text-xs text-gray-500 border-b border-gray-100 bg-gray-50/80 flex items-center justify-between" id="map-count-info"></div>
<div class="flex-1 overflow-y-auto" id="map-list"></div>
</div>
<!-- Right Panel: Map -->
<div class="flex-1 relative">
<div id="explore-map" class="w-full h-full" style="z-index:0"></div>
</div>
</div>

<!-- JAVASCRIPT -->
<script>
/* â”€â”€ Mock Data â”€â”€ */
const REGIONS=[
{dong_code:"1168010100",sido:"ì„œìš¸",sigungu:"ê°•ë‚¨êµ¬",dong:"ì—­ì‚¼ë™",population:32450,age_20_39_pct:35,age_40_59_pct:28,age_60_plus_pct:19,dental_count:12,pop_per_clinic:2704,avg_rent_pyeong:18,area_pyeong:40,subway_station:"ì—­ì‚¼ì—­",subway_line:"2í˜¸ì„ ",subway_walk_min:3,bus_stops_500m:8,daily_floating:85000,pop_growth_rate:1.2,commercial_grade:"A",scores:{population:82,competition:55,cost:48,access:91,growth:68,total:72},grade:"B",lat:37.5007,lng:127.0365},
{dong_code:"1165010700",sido:"ì„œìš¸",sigungu:"ì„œì´ˆêµ¬",dong:"ì„œì´ˆë™",population:28300,age_20_39_pct:32,age_40_59_pct:30,age_60_plus_pct:20,dental_count:15,pop_per_clinic:1887,avg_rent_pyeong:20,area_pyeong:40,subway_station:"ì„œì´ˆì—­",subway_line:"2í˜¸ì„ ",subway_walk_min:5,bus_stops_500m:6,daily_floating:72000,pop_growth_rate:0.8,commercial_grade:"A",scores:{population:75,competition:42,cost:40,access:85,growth:60,total:63},grade:"C",lat:37.4837,lng:127.0073},
{dong_code:"4146310100",sido:"ê²½ê¸°",sigungu:"ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬",dong:"íŒêµë™",population:41200,age_20_39_pct:40,age_40_59_pct:32,age_60_plus_pct:10,dental_count:8,pop_per_clinic:5150,avg_rent_pyeong:12,area_pyeong:40,subway_station:"íŒêµì—­",subway_line:"ì‹ ë¶„ë‹¹ì„ ",subway_walk_min:7,bus_stops_500m:5,daily_floating:95000,pop_growth_rate:5.8,commercial_grade:"A",scores:{population:90,competition:82,cost:72,access:75,growth:95,total:85},grade:"A",lat:37.3948,lng:127.1112},
{dong_code:"1120010300",sido:"ì„œìš¸",sigungu:"ì„±ë™êµ¬",dong:"ì„±ìˆ˜ë™",population:25600,age_20_39_pct:42,age_40_59_pct:25,age_60_plus_pct:15,dental_count:6,pop_per_clinic:4267,avg_rent_pyeong:14,area_pyeong:35,subway_station:"ì„±ìˆ˜ì—­",subway_line:"2í˜¸ì„ ",subway_walk_min:4,bus_stops_500m:7,daily_floating:68000,pop_growth_rate:4.2,commercial_grade:"B",scores:{population:78,competition:78,cost:65,access:88,growth:88,total:79},grade:"B",lat:37.5445,lng:127.0564},
{dong_code:"1174010100",sido:"ì„œìš¸",sigungu:"ë§ˆí¬êµ¬",dong:"í•©ì •ë™",population:19800,age_20_39_pct:45,age_40_59_pct:22,age_60_plus_pct:14,dental_count:7,pop_per_clinic:2829,avg_rent_pyeong:13,area_pyeong:30,subway_station:"í•©ì •ì—­",subway_line:"2Â·6í˜¸ì„ ",subway_walk_min:2,bus_stops_500m:9,daily_floating:62000,pop_growth_rate:3.1,commercial_grade:"B",scores:{population:68,competition:65,cost:68,access:95,growth:82,total:74},grade:"B",lat:37.5496,lng:126.9139},
{dong_code:"4111710100",sido:"ê²½ê¸°",sigungu:"ìˆ˜ì›ì‹œ ì˜í†µêµ¬",dong:"ê´‘êµë™",population:52000,age_20_39_pct:38,age_40_59_pct:35,age_60_plus_pct:8,dental_count:10,pop_per_clinic:5200,avg_rent_pyeong:10,area_pyeong:45,subway_station:"ê´‘êµì—­",subway_line:"ì‹ ë¶„ë‹¹ì„ ",subway_walk_min:8,bus_stops_500m:4,daily_floating:45000,pop_growth_rate:7.2,commercial_grade:"B",scores:{population:92,competition:85,cost:80,access:68,growth:98,total:87},grade:"A",lat:37.2935,lng:127.0454},
{dong_code:"3020011200",sido:"ëŒ€ì „",sigungu:"ìœ ì„±êµ¬",dong:"ë´‰ëª…ë™",population:35800,age_20_39_pct:36,age_40_59_pct:28,age_60_plus_pct:16,dental_count:9,pop_per_clinic:3978,avg_rent_pyeong:8,area_pyeong:40,subway_station:"ì‹œì²­ì—­",subway_line:"1í˜¸ì„ ",subway_walk_min:10,bus_stops_500m:6,daily_floating:38000,pop_growth_rate:2.5,commercial_grade:"B",scores:{population:80,competition:72,cost:88,access:62,growth:75,total:77},grade:"B",lat:36.3623,lng:127.3561},
{dong_code:"2644010100",sido:"ë¶€ì‚°",sigungu:"í•´ìš´ëŒ€êµ¬",dong:"ìš°ë™",population:48500,age_20_39_pct:30,age_40_59_pct:32,age_60_plus_pct:18,dental_count:14,pop_per_clinic:3464,avg_rent_pyeong:11,area_pyeong:40,subway_station:"í•´ìš´ëŒ€ì—­",subway_line:"2í˜¸ì„ ",subway_walk_min:6,bus_stops_500m:7,daily_floating:55000,pop_growth_rate:1.5,commercial_grade:"A",scores:{population:85,competition:60,cost:75,access:78,growth:65,total:74},grade:"B",lat:35.1631,lng:129.1636}
];

/* â”€â”€ Utility â”€â”€ */
function fmt(n){return new Intl.NumberFormat('ko-KR').format(n)}
function getGradeColor(g){return{S:'text-purple-600 bg-purple-50',A:'text-blue-600 bg-blue-50',B:'text-green-600 bg-green-50',C:'text-yellow-600 bg-yellow-50',D:'text-orange-600 bg-orange-50'}[g]||'text-red-600 bg-red-50'}
function getScoreColor(s){return s>=80?'text-blue-600':s>=60?'text-green-600':s>=40?'text-yellow-600':'text-red-500'}
function getScoreBarColor(s){return s>=80?'bg-blue-500':s>=60?'bg-green-500':s>=40?'bg-yellow-500':'bg-red-500'}
function closeMobile(){document.getElementById('mobile-menu').classList.add('hidden')}

/* â”€â”€ Region Generation â”€â”€ */
function hashStr(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return Math.abs(h)}
function seededRand(seed,min,max){seed=(seed*9301+49297)%233280;return min+Math.floor((seed/233280)*(max-min+1))}
function fmtRevKr(v){return v>=10000?((v/10000).toFixed(1)+'ì–µ'):(fmt(v)+'ë§Œ')}

function resolveGeoFromName(name){
  const areas=[
    {kw:['ëŒ€ì „'],lat:36.3504,lng:126.3845,sido:'ëŒ€ì „ê´‘ì—­ì‹œ',
      gu:[{kw:'ì¤‘êµ¬',lat:36.3254,lng:127.4214},{kw:'ì„œêµ¬',lat:36.3555,lng:127.3835},{kw:'ë™êµ¬',lat:36.3121,lng:127.4549},{kw:'ìœ ì„±êµ¬',lat:36.3622,lng:127.3561},{kw:'ëŒ€ë•êµ¬',lat:36.3467,lng:127.4153}]},
    {kw:['ì„œìš¸'],lat:37.5665,lng:126.978,sido:'ì„œìš¸íŠ¹ë³„ì‹œ',
      gu:[{kw:'ê°•ë‚¨êµ¬',lat:37.5172,lng:127.0473},{kw:'ì„œì´ˆêµ¬',lat:37.4837,lng:127.0324},{kw:'ì†¡íŒŒêµ¬',lat:37.5145,lng:127.1050},{kw:'ê°•ë™êµ¬',lat:37.5301,lng:127.1238},{kw:'ë§ˆí¬êµ¬',lat:37.5664,lng:126.9018},{kw:'ìš©ì‚°êµ¬',lat:37.5326,lng:126.9906},{kw:'ì¢…ë¡œêµ¬',lat:37.5735,lng:126.9790},{kw:'ì¤‘êµ¬',lat:37.5641,lng:126.9979},{kw:'ì˜ë“±í¬êµ¬',lat:37.5264,lng:126.8963},{kw:'ê°•ì„œêµ¬',lat:37.5510,lng:126.8495},{kw:'êµ¬ë¡œêµ¬',lat:37.4954,lng:126.8874},{kw:'ê´€ì•…êµ¬',lat:37.4784,lng:126.9516},{kw:'ë™ì‘êµ¬',lat:37.5124,lng:126.9393},{kw:'ì„±ë™êµ¬',lat:37.5634,lng:127.0369},{kw:'ê´‘ì§„êµ¬',lat:37.5385,lng:127.0823},{kw:'ë™ëŒ€ë¬¸êµ¬',lat:37.5744,lng:127.0396},{kw:'ì¤‘ë‘êµ¬',lat:37.6063,lng:127.0926},{kw:'ì„±ë¶êµ¬',lat:37.5894,lng:127.0164},{kw:'ê°•ë¶êµ¬',lat:37.6397,lng:127.0253},{kw:'ë„ë´‰êµ¬',lat:37.6688,lng:127.0471},{kw:'ë…¸ì›êµ¬',lat:37.6542,lng:127.0568},{kw:'ì€í‰êµ¬',lat:37.6027,lng:126.9291},{kw:'ì„œëŒ€ë¬¸êµ¬',lat:37.5791,lng:126.9368},{kw:'ì–‘ì²œêµ¬',lat:37.5170,lng:126.8664},{kw:'ê¸ˆì²œêµ¬',lat:37.4569,lng:126.8955}]},
    {kw:['ë¶€ì‚°'],lat:35.1796,lng:129.0756,sido:'ë¶€ì‚°ê´‘ì—­ì‹œ',
      gu:[{kw:'í•´ìš´ëŒ€êµ¬',lat:35.1631,lng:129.1636},{kw:'ë¶€ì‚°ì§„êµ¬',lat:35.1631,lng:129.0533},{kw:'ë™ë˜êµ¬',lat:35.2050,lng:129.0858},{kw:'ë‚¨êµ¬',lat:35.1368,lng:129.0845},{kw:'ì¤‘êµ¬',lat:35.1060,lng:129.0325},{kw:'ì„œêµ¬',lat:35.0982,lng:129.0244},{kw:'ë¶êµ¬',lat:35.1974,lng:129.0312},{kw:'ì‚¬ìƒêµ¬',lat:35.1526,lng:128.9912},{kw:'ì—°ì œêµ¬',lat:35.1762,lng:129.0801},{kw:'ìˆ˜ì˜êµ¬',lat:35.1458,lng:129.1133},{kw:'ê¸ˆì •êµ¬',lat:35.2432,lng:129.0913},{kw:'ì‚¬í•˜êµ¬',lat:35.1046,lng:128.9747},{kw:'ê°•ì„œêµ¬',lat:35.2121,lng:128.9809}]},
    {kw:['ì¸ì²œ'],lat:37.4563,lng:126.7052,sido:'ì¸ì²œê´‘ì—­ì‹œ',
      gu:[{kw:'ë‚¨ë™êµ¬',lat:37.4488,lng:126.7369},{kw:'ë¶€í‰êµ¬',lat:37.5076,lng:126.7219},{kw:'ì—°ìˆ˜êµ¬',lat:37.4101,lng:126.6783},{kw:'ì„œêµ¬',lat:37.5451,lng:126.6760},{kw:'ì¤‘êµ¬',lat:37.4738,lng:126.6217},{kw:'ë¯¸ì¶”í™€êµ¬',lat:37.4421,lng:126.6993},{kw:'ê³„ì–‘êµ¬',lat:37.5372,lng:126.7376}]},
    {kw:['ëŒ€êµ¬'],lat:35.8714,lng:128.6014,sido:'ëŒ€êµ¬ê´‘ì—­ì‹œ',
      gu:[{kw:'ì¤‘êµ¬',lat:35.8694,lng:128.6064},{kw:'ìˆ˜ì„±êµ¬',lat:35.8583,lng:128.6315},{kw:'ë‹¬ì„œêµ¬',lat:35.8299,lng:128.5327},{kw:'ë¶êµ¬',lat:35.8858,lng:128.5828},{kw:'ë™êµ¬',lat:35.8864,lng:128.6355},{kw:'ì„œêµ¬',lat:35.8718,lng:128.5592},{kw:'ë‚¨êµ¬',lat:35.8460,lng:128.5975}]},
    {kw:['ê´‘ì£¼'],lat:35.1595,lng:126.8526,sido:'ê´‘ì£¼ê´‘ì—­ì‹œ',
      gu:[{kw:'ì„œêµ¬',lat:35.1522,lng:126.8895},{kw:'ë¶êµ¬',lat:35.1744,lng:126.9120},{kw:'ë‚¨êµ¬',lat:35.1326,lng:126.9024},{kw:'ë™êµ¬',lat:35.1461,lng:126.9231},{kw:'ê´‘ì‚°êµ¬',lat:35.1395,lng:126.7938}]},
    {kw:['ìš¸ì‚°'],lat:35.5384,lng:129.3114,sido:'ìš¸ì‚°ê´‘ì—­ì‹œ',
      gu:[{kw:'ë‚¨êµ¬',lat:35.5444,lng:129.3303},{kw:'ì¤‘êµ¬',lat:35.5694,lng:129.3327},{kw:'ë™êµ¬',lat:35.5050,lng:129.4166},{kw:'ë¶êµ¬',lat:35.5826,lng:129.3610},{kw:'ìš¸ì£¼êµ°',lat:35.5224,lng:129.2441}]},
    {kw:['ì„¸ì¢…'],lat:36.4801,lng:126.9270,sido:'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ',gu:[]},
    {kw:['ìˆ˜ì›'],lat:37.2636,lng:127.0286,sido:'ê²½ê¸°ë„',gu:[{kw:'ì˜í†µêµ¬',lat:37.2596,lng:127.0462},{kw:'íŒ”ë‹¬êµ¬',lat:37.2829,lng:127.0204},{kw:'ì¥ì•ˆêµ¬',lat:37.3038,lng:127.0101},{kw:'ê¶Œì„ êµ¬',lat:37.2572,lng:126.9719}]},
    {kw:['ì„±ë‚¨'],lat:37.4200,lng:127.1267,sido:'ê²½ê¸°ë„',gu:[{kw:'ë¶„ë‹¹êµ¬',lat:37.3825,lng:127.1188},{kw:'ìˆ˜ì •êµ¬',lat:37.4504,lng:127.1457},{kw:'ì¤‘ì›êµ¬',lat:37.4317,lng:127.1372}]},
    {kw:['ê³ ì–‘'],lat:37.6584,lng:126.8320,sido:'ê²½ê¸°ë„',gu:[{kw:'ì¼ì‚°ë™êµ¬',lat:37.6586,lng:126.7742},{kw:'ì¼ì‚°ì„œêµ¬',lat:37.6756,lng:126.7513},{kw:'ë•ì–‘êµ¬',lat:37.6376,lng:126.8320}]},
    {kw:['ìš©ì¸'],lat:37.2411,lng:127.1775,sido:'ê²½ê¸°ë„',gu:[{kw:'ìˆ˜ì§€êµ¬',lat:37.3219,lng:127.0981},{kw:'ê¸°í¥êµ¬',lat:37.2802,lng:127.1151},{kw:'ì²˜ì¸êµ¬',lat:37.2342,lng:127.2019}]},
    {kw:['ì°½ì›'],lat:35.2280,lng:128.6811,sido:'ê²½ìƒë‚¨ë„',gu:[{kw:'ì„±ì‚°êµ¬',lat:35.1989,lng:128.7119},{kw:'ì˜ì°½êµ¬',lat:35.2538,lng:128.6389},{kw:'ë§ˆì‚°í•©í¬êµ¬',lat:35.1855,lng:128.5683},{kw:'ë§ˆì‚°íšŒì›êµ¬',lat:35.2215,lng:128.5813},{kw:'ì§„í•´êµ¬',lat:35.1336,lng:128.7107}]},
    {kw:['ì²­ì£¼'],lat:36.6424,lng:127.4890,sido:'ì¶©ì²­ë¶ë„',gu:[{kw:'í¥ë•êµ¬',lat:36.6373,lng:127.4329},{kw:'ì„œì›êµ¬',lat:36.6093,lng:127.4712},{kw:'ìƒë‹¹êµ¬',lat:36.6539,lng:127.4901},{kw:'ì²­ì›êµ¬',lat:36.6952,lng:127.4879}]},
    {kw:['ì „ì£¼'],lat:35.8242,lng:127.1480,sido:'ì „ë¼ë¶ë„',gu:[{kw:'ì™„ì‚°êµ¬',lat:35.8123,lng:127.1365},{kw:'ë•ì§„êµ¬',lat:35.8423,lng:127.1344}]},
    {kw:['ì²œì•ˆ'],lat:36.8151,lng:127.1139,sido:'ì¶©ì²­ë‚¨ë„',gu:[{kw:'ì„œë¶êµ¬',lat:36.8502,lng:127.1435},{kw:'ë™ë‚¨êµ¬',lat:36.7889,lng:127.1652}]},
    {kw:['ì•ˆì‚°'],lat:37.3219,lng:126.8309,sido:'ê²½ê¸°ë„',gu:[{kw:'ìƒë¡êµ¬',lat:37.3004,lng:126.8461},{kw:'ë‹¨ì›êµ¬',lat:37.3184,lng:126.7962}]},
    {kw:['ì•ˆì–‘'],lat:37.3943,lng:126.9568,sido:'ê²½ê¸°ë„',gu:[{kw:'ë§Œì•ˆêµ¬',lat:37.3866,lng:126.9327},{kw:'ë™ì•ˆêµ¬',lat:37.3929,lng:126.9517}]},
    {kw:['ì œì£¼'],lat:33.4996,lng:126.5312,sido:'ì œì£¼íŠ¹ë³„ìì¹˜ë„',gu:[{kw:'ì œì£¼ì‹œ',lat:33.5100,lng:126.5219},{kw:'ì„œê·€í¬ì‹œ',lat:33.2532,lng:126.5597}]},
    {kw:['í¬í•­'],lat:36.0190,lng:129.3435,sido:'ê²½ìƒë¶ë„',gu:[{kw:'ë‚¨êµ¬',lat:35.9987,lng:129.3652},{kw:'ë¶êµ¬',lat:36.0441,lng:129.3719}]},
    {kw:['ê¹€í•´'],lat:35.2285,lng:128.8894,sido:'ê²½ìƒë‚¨ë„',gu:[]},
    {kw:['í‰íƒ'],lat:36.9921,lng:127.0866,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['íŒŒì£¼'],lat:37.7599,lng:126.7801,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì‹œí¥'],lat:37.3800,lng:126.8028,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['í™”ì„±'],lat:37.1994,lng:126.8313,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ê¹€í¬'],lat:37.6152,lng:126.7156,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ê´‘ëª…'],lat:37.4786,lng:126.8645,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['êµ°í¬'],lat:37.3614,lng:126.9352,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['í•˜ë‚¨'],lat:37.5393,lng:127.2147,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì–‘ì‚°'],lat:35.3350,lng:129.0372,sido:'ê²½ìƒë‚¨ë„',gu:[]},
    {kw:['êµ¬ë¯¸'],lat:36.1197,lng:128.3440,sido:'ê²½ìƒë¶ë„',gu:[]},
    {kw:['ì¶˜ì²œ'],lat:37.8813,lng:127.7300,sido:'ê°•ì›íŠ¹ë³„ìì¹˜ë„',gu:[]},
    {kw:['ì›ì£¼'],lat:37.3423,lng:127.9202,sido:'ê°•ì›íŠ¹ë³„ìì¹˜ë„',gu:[]},
    {kw:['ê°•ë¦‰'],lat:37.7519,lng:128.8761,sido:'ê°•ì›íŠ¹ë³„ìì¹˜ë„',gu:[]},
    {kw:['ì—¬ìˆ˜'],lat:34.7604,lng:127.6622,sido:'ì „ë¼ë‚¨ë„',gu:[]},
    {kw:['ìˆœì²œ'],lat:34.9506,lng:127.4872,sido:'ì „ë¼ë‚¨ë„',gu:[]},
    {kw:['ëª©í¬'],lat:34.8118,lng:126.3922,sido:'ì „ë¼ë‚¨ë„',gu:[]},
    {kw:['ìµì‚°'],lat:35.9483,lng:126.9577,sido:'ì „ë¼ë¶ë„',gu:[]},
    {kw:['êµ°ì‚°'],lat:35.9674,lng:126.7369,sido:'ì „ë¼ë¶ë„',gu:[]},
    {kw:['ê²½ì£¼'],lat:35.8562,lng:129.2247,sido:'ê²½ìƒë¶ë„',gu:[]},
    {kw:['ê±°ì œ'],lat:34.8806,lng:128.6213,sido:'ê²½ìƒë‚¨ë„',gu:[]},
    {kw:['ì–‘ì£¼'],lat:37.7854,lng:127.0456,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì˜ì •ë¶€'],lat:37.7381,lng:127.0337,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ë‚¨ì–‘ì£¼'],lat:37.6360,lng:127.2163,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì´ì²œ'],lat:37.2720,lng:127.4348,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì˜¤ì‚°'],lat:37.1498,lng:127.0697,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ê´‘ì£¼ì‹œ','ê²½ê¸° ê´‘ì£¼'],lat:37.4095,lng:127.2551,sido:'ê²½ê¸°ë„',gu:[]},
    {kw:['ì¶©ì£¼'],lat:36.9910,lng:127.9259,sido:'ì¶©ì²­ë¶ë„',gu:[]},
    {kw:['ì•„ì‚°'],lat:36.7899,lng:127.0018,sido:'ì¶©ì²­ë‚¨ë„',gu:[]},
    {kw:['ì„œì‚°'],lat:36.7845,lng:126.4503,sido:'ì¶©ì²­ë‚¨ë„',gu:[]},
    {kw:['í™ëŒ€','í™ëŒ€ì…êµ¬'],lat:37.5563,lng:126.9237,sido:'ì„œìš¸íŠ¹ë³„ì‹œ',gu:[]},
    {kw:['ì ì‹¤'],lat:37.5133,lng:127.1001,sido:'ì„œìš¸íŠ¹ë³„ì‹œ',gu:[]},
    {kw:['ê°•ë‚¨'],lat:37.4979,lng:127.0276,sido:'ì„œìš¸íŠ¹ë³„ì‹œ',gu:[]},
    {kw:['íŒêµ'],lat:37.3947,lng:127.1112,sido:'ê²½ê¸°ë„',gu:[]}
  ];
  let baseLat=37.5665,baseLng=126.978,sido='',sigungu='';
  for(const a of areas){
    const cityMatch=a.kw.some(k=>name.includes(k));
    if(cityMatch){
      baseLat=a.lat;baseLng=a.lng;sido=a.sido;
      for(const g of a.gu){
        if(name.includes(g.kw)){baseLat=g.lat;baseLng=g.lng;sigungu=g.kw;break}
      }
      if(!sigungu&&a.kw[0])sigungu=a.kw[0];
      break;
    }
  }
  return{lat:baseLat,lng:baseLng,sido:sido,sigungu:sigungu};
}

function generateRegion(name){
  const h=hashStr(name),r=n=>(a,b)=>seededRand(h*n+n,a,b);
  const geo=resolveGeoFromName(name);
  const pop=r(1)(15000,60000),dental=r(2)(3,18),rent=r(3)(6,22),area=r(4)(25,50),wk=r(5)(2,15),bus=r(6)(2,10),fl=r(7)(20000,100000);
  const gr=parseFloat(((r(8)(0,80)-20)/10).toFixed(1)),a20=r(9)(25,48),a40=r(10)(20,35),a60=Math.max(0,100-a20-a40);
  const ps=Math.min(100,Math.max(30,Math.round(pop/600)+r(11)(-5,5))),cs=Math.min(100,Math.max(20,100-dental*5+r(12)(-5,10)));
  const co=Math.min(100,Math.max(20,100-rent*3+r(13)(-5,5))),ac=Math.min(100,Math.max(30,100-wk*4+bus*3+r(14)(-5,5)));
  const gs=Math.min(100,Math.max(20,50+Math.round(gr*8)+r(15)(-5,5)));
  const tot=Math.round(ps*0.25+cs*0.25+co*0.2+ac*0.15+gs*0.15);
  const gd=tot>=80?'A':tot>=70?'B':tot>=60?'C':'D';
  const localStations=geo.sido.includes('ëŒ€ì „')?['ëŒ€ì „ì—­','ìœ ì„±ì˜¨ì²œì—­','íƒ„ë°©ì—­','ì‹œì²­ì—­','ì¤‘ì•™ë¡œì—­','ëŒ€ë™ì—­','ì •ë¶€ì²­ì‚¬ì—­','ê°ˆë§ˆì—­','ì›”í‰ì—­','ìš©ë¬¸ì—­']:
    geo.sido.includes('ë¶€ì‚°')?['ì„œë©´ì—­','í•´ìš´ëŒ€ì—­','ë¶€ì‚°ì—­','ë‚¨í¬ë™ì—­','ì„¼í…€ì‹œí‹°ì—­','ë™ë˜ì—­','ë•ì²œì—­','ì‚¬ìƒì—­','ì—°ì‚°ì—­','ìˆ˜ì˜ì—­']:
    geo.sido.includes('ëŒ€êµ¬')?['ë°˜ì›”ë‹¹ì—­','ë™ëŒ€êµ¬ì—­','ì¤‘ì•™ë¡œì—­','ìˆ˜ì„±êµ¬ì²­ì—­','ë²”ì–´ì—­','ë‹¬ì„œêµ¬ì²­ì—­','ì„±ë‹¹ëª»ì—­','ë‘ë¥˜ì—­','ì¹ ì„±ì‹œì¥ì—­','ë§Œí‰ì—­']:
    geo.sido.includes('ì¸ì²œ')?['ë¶€í‰ì—­','ì¸ì²œì—­','êµ¬ì›”ì—­','ê°„ì„ì—­','ì¸ì²œì‹œì²­ì—­','ì£¼ì•ˆì—­','ì†¡ë„ì—­','ì²­ë¼ì—­','ì‘ì „ì—­','ë¶€ê°œì—­']:
    geo.sido.includes('ê´‘ì£¼')?['ìƒë¬´ì—­','ê¸ˆë‚¨ë¡œì—­','ì–‘ë™ì‹œì¥ì—­','ìš´ì²œì—­','ì†¡ì •ì—­','ì²¨ë‹¨ì—­','í‰ë™ì—­','ë…¹ë™ì—­','í•™ë™ì—­','ë‚¨ê´‘ì£¼ì—­']:
    geo.sido.includes('ìš¸ì‚°')?['ìš¸ì‚°ì—­','íƒœí™”ê°•ì—­','ì‹ ë³µì—­','ë•í•˜ì—­','ë‚¨ì°½ì—­','ìš¸ì‚°KTXì—­','íš¨ë¬¸ì—­','ì•¼ìŒì—­','ì„ ì•”ì—­','ì¥ìƒí¬ì—­']:
    ['ì—­ì‚¼ì—­','ê°•ë‚¨ì—­','í™ëŒ€ì…êµ¬ì—­','ì‹ ì´Œì—­','ì ì‹¤ì—­','ê±´ëŒ€ì…êµ¬ì—­','ì‚¬ë‹¹ì—­','ì™•ì‹­ë¦¬ì—­','ì„ì§€ë¡œì—­','ì¢…ê°ì—­','ì‹ ë¦¼ì—­','íŒêµì—­','ìˆ˜ì›ì—­','ì¸ì²œì—­'];
  const lns=geo.sido.includes('ëŒ€ì „')?['1í˜¸ì„ ','ëŒ€ì „1í˜¸ì„ ']:geo.sido.includes('ë¶€ì‚°')?['1í˜¸ì„ ','2í˜¸ì„ ','3í˜¸ì„ ','4í˜¸ì„ ','ë™í•´ì„ ']:geo.sido.includes('ëŒ€êµ¬')?['1í˜¸ì„ ','2í˜¸ì„ ','3í˜¸ì„ ']:geo.sido.includes('ê´‘ì£¼')?['1í˜¸ì„ ']:['2í˜¸ì„ ','3í˜¸ì„ ','4í˜¸ì„ ','7í˜¸ì„ ','9í˜¸ì„ ','ì‹ ë¶„ë‹¹ì„ ','ê²½ì˜ì¤‘ì•™ì„ ','1í˜¸ì„ ','5í˜¸ì„ ','6í˜¸ì„ '];
  const cg=['A','B','C'];
  const jitter=0.002;
  return{dong_code:'GEN'+h.toString().slice(0,7).padStart(7,'0'),sido:geo.sido,sigungu:geo.sigungu,dong:name,population:pop,age_20_39_pct:a20,age_40_59_pct:a40,age_60_plus_pct:a60,dental_count:dental,pop_per_clinic:Math.round(pop/dental),avg_rent_pyeong:rent,area_pyeong:area,subway_station:localStations[h%localStations.length],subway_line:lns[h%lns.length],subway_walk_min:wk,bus_stops_500m:bus,daily_floating:fl,pop_growth_rate:gr,commercial_grade:cg[h%cg.length],scores:{population:ps,competition:cs,cost:co,access:ac,growth:gs,total:tot},grade:gd,lat:geo.lat+((h%100)-50)*jitter/50,lng:geo.lng+((h%100)-50)*jitter/50,_generated:true};
}

function addGeneratedRegion(name){
  const ex=REGIONS.find(r=>r.dong===name&&r._generated);if(ex)return ex;
  const r=generateRegion(name);REGIONS.push(r);return r;
}

/* â”€â”€ Leaflet Map Legend â”€â”€ */
function addMapLegend(map,type){
  const legend=L.control({position:'bottomright'});
  legend.onAdd=function(){
    const div=L.DomUtil.create('div','map-legend collapsed');
    L.DomEvent.disableClickPropagation(div);
    L.DomEvent.disableScrollPropagation(div);
    let h='<h4 onclick="this.parentElement.classList.toggle(\'collapsed\')"><span>ë²”ë¡€</span><span class="leg-arrow">â–¼</span></h4><div class="leg-body">';
    h+='<div class="leg-section"><div class="leg-title">ë§ˆì»¤</div>';
    if(type==='explore'){
      h+='<div class="leg-row"><div class="leg-dot" style="background:#3b82f6"></div>ì ìˆ˜ 80+ (ë†’ìŒ)</div>';
      h+='<div class="leg-row"><div class="leg-dot" style="background:#22c55e"></div>ì ìˆ˜ 70+ (ì–‘í˜¸)</div>';
      h+='<div class="leg-row"><div class="leg-dot" style="background:#eab308"></div>ì ìˆ˜ 60+ (ë³´í†µ)</div>';
      h+='<div class="leg-row"><div class="leg-dot" style="background:#ef4444"></div>ì ìˆ˜ 60- (ë‚®ìŒ)</div>';
    } else {
      h+='<div class="leg-row"><div class="leg-dot" style="background:#3b82f6"></div>ë¶„ì„ ì¤‘ì‹¬</div>';
    }
    h+='<div class="leg-row"><div class="leg-dot" style="background:#ef4444"></div>ì˜ì—…ì¤‘ ì¹˜ê³¼</div>';
    h+='<div class="leg-row"><div class="leg-dot" style="background:#eab308"></div>íœ´ì—… ì¹˜ê³¼</div>';
    h+='<div class="leg-row"><div class="leg-dot" style="background:#9ca3af"></div>íì—… ì¹˜ê³¼</div>';
    h+='<div class="leg-row"><div class="leg-dot" style="background:linear-gradient(135deg,#f59e0b,#d97706)"></div>ì¶”ì²œ ê°œì› ìœ„ì¹˜</div>';
    h+='</div>';
    h+='<div class="leg-section"><div class="leg-title">ìƒíƒœ ë°°ì§€</div>';
    h+='<div style="display:flex;flex-wrap:wrap;gap:3px">';
    h+='<span class="leg-badge" style="background:#dcfce7;color:#166534">ì˜ì—…ì¤‘</span>';
    h+='<span class="leg-badge" style="background:#fef9c3;color:#854d0e">íœ´ì—…</span>';
    h+='<span class="leg-badge" style="background:#fee2e2;color:#991b1b">íì—…</span>';
    h+='<span class="leg-badge" style="background:#ede9fe;color:#6d28d9">ì¸ìˆ˜ê°€ëŠ¥</span>';
    h+='</div></div>';
    h+='<div class="leg-section"><div class="leg-title">ê²½ìŸ ìœ„í˜‘ë„</div>';
    h+='<div class="leg-row"><span style="color:#dc2626;font-weight:700;font-size:10px">â—</span> ë†’ìŒ</div>';
    h+='<div class="leg-row"><span style="color:#d97706;font-weight:700;font-size:10px">â—</span> ë³´í†µ</div>';
    h+='<div class="leg-row"><span style="color:#16a34a;font-weight:700;font-size:10px">â—</span> ë‚®ìŒ</div>';
    h+='</div>';
    h+='<div class="leg-section"><div class="leg-title">êµ¬ë¶„ ë°°ì§€</div>';
    h+='<div style="display:flex;flex-wrap:wrap;gap:3px">';
    h+='<span class="leg-badge" style="background:#e0f2fe;color:#0369a1">ì§„ë£Œë¹„</span>';
    h+='<span class="leg-badge" style="background:#f3e8ff;color:#7c3aed">ì§„ë£Œì‹œê°„</span>';
    h+='<span class="leg-badge" style="background:#f0fdf4;color:#15803d">ì „ë¬¸ë¶„ì•¼</span>';
    h+='</div></div>';
    h+='<div class="leg-section"><div class="leg-title">ë§¤ì¶œÂ·ì¸ìˆ˜</div>';
    h+='<div class="leg-row"><span class="leg-badge" style="background:#ecfdf5;color:#059669">ì—°/ì›”ë§¤ì¶œ</span> ì¶”ì • ë§¤ì¶œ</div>';
    h+='<div class="leg-row"><span class="leg-badge" style="background:#f5f3ff;color:#7c3aed">ì¸ìˆ˜ê°€</span> ì˜ˆìƒ ì¸ìˆ˜ê°€</div>';
    h+='</div>';
    h+='</div>';
    div.innerHTML=h;
    return div;
  };
  legend.addTo(map);
  return legend;
}

/* â”€â”€ Clinic Functions â”€â”€ */
function clinicStatusBadge(c){
  const sc=c.status==='ì˜ì—…ì¤‘'?'background:#dcfce7;color:#166534':c.status==='íœ´ì—…'?'background:#fef9c3;color:#854d0e':'background:#fee2e2;color:#991b1b';
  return '<span style="'+sc+';padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600">'+c.status+'</span>';
}
function clinicForSaleBadge(c){
  return c.forSale?'<span style="background:#ede9fe;color:#6d28d9;padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600;margin-left:3px">ì¸ìˆ˜ê°€ëŠ¥</span>':'';
}
function nightWeekendLabel(nw){return nw===2?'ì•¼ê°„+ì£¼ë§':nw===1?'ì£¼ë§ì§„ë£Œ':'í‰ì¼ë§Œ'}

function buildClinicPopup(c){
  const r='<div style="min-width:260px;max-width:300px;font-family:Pretendard Variable,sans-serif;font-size:12px">'
    +'<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px"><b style="font-size:14px;color:#1d4ed8">'+c.name+'</b><div>'+clinicStatusBadge(c)+clinicForSaleBadge(c)+'</div></div>'
    +'<div style="margin-bottom:6px;display:flex;flex-wrap:wrap;gap:3px"><span style="background:#fee2e2;color:#dc2626;padding:1px 6px;border-radius:4px;font-size:11px">'+c.type+'</span>'
    +'<span style="background:#e0f2fe;color:#0369a1;padding:1px 6px;border-radius:4px;font-size:11px">'+c.priceLevel+'</span>'
    +'<span style="background:#f3e8ff;color:#7c3aed;padding:1px 6px;border-radius:4px;font-size:11px">'+nightWeekendLabel(c.nightWeekend)+'</span></div>'
    +'<div style="color:#4b5563">'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ì›ì¥</span><b>'+c.director+'</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ê°œì›</span><b>'+c.estYear+'ë…„ ('+c.yearsOpen+'ë…„ì°¨)</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ê·œëª¨</span><b>ì²´ì–´ '+c.chairs+'ëŒ€ Â· '+c.size+'</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ìœ„ì¹˜</span><b>'+c.floor+(c.hasParking?' Â· ğŸ…¿ï¸':'')+'</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ì¸ë ¥</span><b>ì˜ì‚¬ '+c.dentistCount+'ëª… Â· ìœ„ìƒì‚¬ '+c.hygienistCount+'ëª… Â· ì´ '+c.totalStaff+'ëª…</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ì¼í‰ê·  í™˜ì</span><b>'+c.dailyPatients+'ëª…</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ë³´í—˜ì²­êµ¬</span><b>ì›” '+fmt(c.insuranceClaims)+'ê±´ (ë¹„ê¸‰ì—¬ '+c.nonCoverageRatio+'%)</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ë„¤ì´ë²„</span><b style="color:#f59e0b">â˜… '+c.naverRating+' <span style="color:#9ca3af;font-weight:400">('+fmt(c.naverReviewCount)+'ê±´)</span></b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ë¸”ë¡œê·¸ ë…¸ì¶œ</span><b>'+fmt(c.blogExposure)+'ê±´</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ê²½ìŸ ìœ„í˜‘ë„</span><b style="color:'+(c.competitionThreat==='ë†’ìŒ'?'#dc2626':c.competitionThreat==='ë³´í†µ'?'#d97706':'#16a34a')+'">'+c.competitionThreat+'</b></div>'
    +'<div style="display:flex;justify-content:space-between;padding:3px 0;border-bottom:1px solid #f3f4f6"><span>ë™ì¢… ê²½ìŸ</span><b>ë°˜ê²½ ë‚´ '+c.sameTypeNearby+'ê°œ</b></div>'
    +'</div>'
    +'<div style="margin-top:6px;display:flex;flex-wrap:wrap;gap:3px">'+c.specialties.map(function(sp){return '<span style="background:#f0fdf4;color:#15803d;padding:1px 5px;border-radius:3px;font-size:10px">'+sp+'</span>'}).join('')+'</div>'
    +'<div style="margin-top:6px;padding-top:6px;border-top:1px solid #e5e7eb;background:#ecfdf5;margin:6px -8px -8px;padding:8px;border-radius:0 0 4px 4px">'
    +'<div style="display:flex;justify-content:space-between;color:#059669;font-weight:600"><span>ì—°ë§¤ì¶œ</span><b>ì•½ '+fmtRevKr(c.annualRevenue)+'ì›</b></div>'
    +'<div style="display:flex;justify-content:space-between;color:#059669;font-size:11px;margin-top:2px"><span>ì›”ë§¤ì¶œ</span><b>ì•½ '+fmtRevKr(c.monthlyRevenue)+'ì›</b></div>'
    +(c.forSale&&c.estimatedAcquisitionPrice?'<div style="display:flex;justify-content:space-between;color:#7c3aed;font-weight:600;margin-top:4px;padding-top:4px;border-top:1px dashed #c4b5fd"><span>ì˜ˆìƒ ì¸ìˆ˜ê°€</span><b>ì•½ '+fmtRevKr(c.estimatedAcquisitionPrice)+'ì›</b></div>':'')
    +'</div></div>';
  return r;
}

function generateNearbyClinics(r){
  const h=hashStr(r.dong_code||r.dong),cnt=r.dental_count||8,clinics=[];
  const types=['ì¼ë°˜ì¹˜ê³¼','êµì •ì¹˜ê³¼','ì†Œì•„ì¹˜ê³¼','ì„í”Œë€íŠ¸ì¹˜ê³¼','ì‹¬ë¯¸ì¹˜ê³¼','í†µí•©ì¹˜ê³¼'];
  const pfx=['ì„œìš¸','ë¯¸ì†Œ','í•´í”¼','ìŠ¤ë§ˆì¼','ì—°ì„¸','ì´ë“ ','í‘¸ë¥¸','ë§‘ì€','ìƒˆë´„','í•˜ë‚˜','ì˜¨','ë¹›','ëŠ˜','ì¢‹ì€','ë°ì€','ì°¸'];
  const dirs=['ê¹€','ì´','ë°•','ìµœ','ì •','ê°•','ì¡°','ìœ¤','ì¥','ì„','í•œ','ì˜¤','ì„œ','ì‹ ','ê¶Œ','í™©'];
  const specPool=['ì„í”Œë€íŠ¸','ì¹˜ì•„êµì •','ì‹¬ë¯¸ë³´ì² ','ì†Œì•„ì§„ë£Œ','ì‡ëª¸ì¹˜ë£Œ','ì¶©ì¹˜ì¹˜ë£Œ','ë¯¸ë°±','í„±ê´€ì ˆ','ì‚¬ë‘ë‹ˆë°œì¹˜','ì¹˜ì•„ì„±í˜•','íˆ¬ëª…êµì •','ë¼ë¯¸ë„¤ì´íŠ¸'];
  for(let i=0;i<cnt;i++){const s=h*100+i;
    const chairs=seededRand(s*29,2,8),sz=seededRand(s*41,15,60),ey=2024-seededRand(s*19,1,15);
    const yearsOpen=2024-ey;
    const yrFactor=Math.min(1.3,1+Math.max(0,yearsOpen-3)*0.02);
    const annRev=Math.round((chairs*7000+sz*120+seededRand(s*43,-3000,8000))*yrFactor);
    const monthlyRev=Math.round(annRev/12);
    const dailyPat=Math.max(5,Math.round(chairs*seededRand(s*47,3,7)+seededRand(s*51,-3,5)));
    const dentistCnt=Math.max(1,Math.round(chairs/2.5)+seededRand(s*53,-1,1));
    const hygienistCnt=Math.max(1,Math.round(chairs*0.8)+seededRand(s*57,-1,1));
    const totalStaff=dentistCnt+hygienistCnt+Math.max(1,seededRand(s*59,1,Math.round(chairs*0.5)+1));
    const insClaims=Math.round(dailyPat*22*seededRand(s*61,60,85)/100);
    const nonCovRatio=seededRand(s*63,25,65);
    const naverRating=(seededRand(s*67,30,50)/10).toFixed(1);
    const naverReviewCnt=Math.round(yearsOpen*seededRand(s*69,15,80)+seededRand(s*71,0,100));
    const blogExposure=seededRand(s*73,50,2000);
    const specCnt=seededRand(s*75,2,5);
    const specs=[];for(let j=0;j<specCnt;j++){const sp=specPool[seededRand(s*77+j*13,0,specPool.length-1)];if(!specs.includes(sp))specs.push(sp)}
    const nightWeekend=seededRand(s*79,0,2);
    const priceLvl=['ì €ê°€','ì¤‘ê°„','ê³ ê°€'][seededRand(s*81,0,2)];
    const threatLvl=chairs>=5&&yearsOpen>=5?'ë†’ìŒ':chairs>=3?'ë³´í†µ':'ë‚®ìŒ';
    const sameTypeNearby=seededRand(s*83,0,Math.min(4,cnt-1));
    const statusRand=seededRand(s*85,0,20);
    const status=statusRand>=2?'ì˜ì—…ì¤‘':statusRand===1?'íœ´ì—…':'íì—…';
    const forSale=status==='íì—…'?true:status==='íœ´ì—…'?seededRand(s*87,0,1)===1:seededRand(s*89,0,8)===0;
    const estAcqPrice=forSale?Math.round(annRev*seededRand(s*91,8,18)/10):null;
    clinics.push({name:pfx[seededRand(s*11,0,pfx.length-1)]+'ì¹˜ê³¼ì˜ì›',type:types[seededRand(s*13,0,types.length-1)],
      director:dirs[seededRand(s*17,0,dirs.length-1)]+'ì›ì¥',lat:r.lat+(seededRand(s*3,-70,70))/10000,lng:r.lng+(seededRand(s*7,-70,70))/10000,
      estYear:ey,rating:(seededRand(s*23,32,50)/10).toFixed(1),chairs:chairs,
      hasParking:seededRand(s*31,0,1)===1,floor:seededRand(s*37,1,8)+'ì¸µ',size:sz+'í‰',annualRevenue:annRev,
      monthlyRevenue:monthlyRev,dailyPatients:dailyPat,dentistCount:dentistCnt,hygienistCount:hygienistCnt,
      totalStaff:totalStaff,insuranceClaims:insClaims,nonCoverageRatio:nonCovRatio,
      naverRating:naverRating,naverReviewCount:naverReviewCnt,blogExposure:blogExposure,
      specialties:specs,nightWeekend:nightWeekend,priceLevel:priceLvl,yearsOpen:yearsOpen,
      competitionThreat:threatLvl,sameTypeNearby:sameTypeNearby,
      status:status,forSale:forSale,estimatedAcquisitionPrice:estAcqPrice})}
  return clinics;
}

function generateRecommendedSpots(r){
  const h=hashStr(r.dong+'_rec'),spots=[];
  const reasons=[['ê²½ìŸ ê³µë°± ì§€ì—­ â€” ë°˜ê²½ 300m ë‚´ ì¹˜ê³¼ ì—†ìŒ','ìœ ë™ì¸êµ¬ ë°€ì§‘ êµ¬ê°„ (ì¼ '+fmt(Math.round(r.daily_floating*0.4))+'ëª…)','ëŒ€ì¤‘êµí†µ ë„ë³´ 5ë¶„ ì´ë‚´','20~39ì„¸ ì Šì€ ì¸êµ¬ ë°€ì§‘'],['ì‹ ê·œ ì•„íŒŒíŠ¸ ë‹¨ì§€ ì¸ì ‘ (ì…ì£¼ 2ë…„ ì´ë‚´)','ì†Œì•„Â·êµì • ìˆ˜ìš” ë†’ì€ ì§€ì—­','ì„ëŒ€ë£Œ ë³¸ ì§€ì—­ ëŒ€ë¹„ 15% ì €ë ´','ì£¼ì°¨ì¥ í™•ë³´ ìš©ì´']];
  for(let i=0;i<2;i++){const s=h*50+i,angle=(seededRand(s,0,360)*Math.PI)/180,dist=seededRand(s*3,40,70)/10000;
    spots.push({lat:r.lat+Math.cos(angle)*dist,lng:r.lng+Math.sin(angle)*dist,
      label:i===0?'ì¶”ì²œ ìœ„ì¹˜ A (ìµœì )':'ì¶”ì²œ ìœ„ì¹˜ B (ëŒ€ì•ˆ)',
      score:Math.min(98,r.scores.total+seededRand(s*7,8,20)-i*5),
      grade:i===0?'S':'A',reasons:reasons[i],
      rent:Math.max(5,r.avg_rent_pyeong-seededRand(s*9,1,4)),estPop:seededRand(s*11,8000,25000)})}
  return spots;
}

/* â”€â”€ Explore Map â”€â”€ */
let exploreMap=null,exploreMarkers=[],mapCurrentRegion=null,mapClinicData=null;

function renderExploreMap(){
  if(exploreMap){exploreMap.remove();exploreMap=null}
  const el=document.getElementById('explore-map');if(!el||typeof L==='undefined')return;
  exploreMap=L.map('explore-map',{scrollWheelZoom:true,zoomControl:true}).setView([36.5,127.5],7);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:18}).addTo(exploreMap);
  addMapLegend(exploreMap,'explore');
  showAllRegionsOnMap();
}

function showAllRegionsOnMap(){
  if(!exploreMap)return;
  exploreMarkers.forEach(m=>exploreMap.removeLayer(m));exploreMarkers=[];
  const search=(document.getElementById('map-search')?document.getElementById('map-search').value:'').trim();
  const filtered=REGIONS.filter(r=>!r._generated&&(!search||r.dong.includes(search)||r.sigungu.includes(search)||r.sido.includes(search)));
  filtered.forEach(r=>{
    const sc=r.scores.total,color=sc>=80?'#3b82f6':sc>=70?'#22c55e':sc>=60?'#eab308':'#ef4444';
    const m=L.marker([r.lat,r.lng],{icon:L.divIcon({className:'',html:'<div style="background:'+color+';color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:13px;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3);cursor:pointer">'+sc+'</div>',iconSize:[40,40],iconAnchor:[20,20]})}).addTo(exploreMap);
    m.bindTooltip(r.dong,{permanent:true,direction:'top',offset:[0,-22],className:'clinic-tooltip'});
    m.on('click',()=>selectMapRegion(r));
    exploreMarkers.push(m);
  });
  if(filtered.length>1)exploreMap.fitBounds(filtered.map(r=>[r.lat,r.lng]),{padding:[50,50]});
  else if(filtered.length===1)exploreMap.setView([filtered[0].lat,filtered[0].lng],14);
}

function showRegionClinicsOnMap(r,clinics,spots){
  if(!exploreMap)return;
  exploreMarkers.forEach(m=>exploreMap.removeLayer(m));exploreMarkers=[];
  /* center */
  const cm=L.marker([r.lat,r.lng],{icon:L.divIcon({className:'',html:'<div style="background:#3b82f6;color:white;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;border:3px solid white;box-shadow:0 2px 10px rgba(59,130,246,0.5)">ğŸ“</div>',iconSize:[36,36],iconAnchor:[18,18]})}).addTo(exploreMap);
  cm.bindPopup('<b>'+r.dong+'</b> ë¶„ì„ ì¤‘ì‹¬<br>ì¢…í•© <b style="color:#3b82f6">'+r.scores.total+'ì </b>');
  exploreMarkers.push(cm);
  /* clinics with permanent name labels */
  clinics.forEach((c,i)=>{
    const mColor=c.status==='ì˜ì—…ì¤‘'?'#ef4444':c.status==='íœ´ì—…'?'#eab308':'#9ca3af';
    const m=L.marker([c.lat,c.lng],{icon:L.divIcon({className:'',html:'<div style="background:'+mColor+';color:white;width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;border:2px solid white;box-shadow:0 1px 4px rgba(0,0,0,0.3)">ğŸ¦·</div>',iconSize:[26,26],iconAnchor:[13,13]})}).addTo(exploreMap);
    m.bindTooltip(c.name+(c.forSale?' ğŸ·':''),{permanent:true,direction:'right',offset:[10,0],className:'clinic-tooltip'});
    m.bindPopup(buildClinicPopup(c),{maxWidth:320});
    m.on('click',()=>{highlightClinicCard(i)});
    exploreMarkers.push(m);
  });
  /* recommended spots */
  spots.forEach(s=>{
    const m=L.marker([s.lat,s.lng],{icon:L.divIcon({className:'',html:'<div style="position:relative"><div style="position:absolute;inset:-6px;background:rgba(245,158,11,0.2);border-radius:50%;animation:marker-pulse 2s infinite"></div><div style="position:relative;background:linear-gradient(135deg,#f59e0b,#d97706);color:white;width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;border:3px solid white;box-shadow:0 2px 8px rgba(245,158,11,0.5)">â­</div></div>',iconSize:[34,34],iconAnchor:[17,17]})}).addTo(exploreMap);
    m.bindTooltip(s.label,{permanent:true,direction:'right',offset:[10,0],className:'rec-tooltip'});
    m.bindPopup('<div style="min-width:200px;font-family:Pretendard Variable,sans-serif"><div style="background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:6px;display:inline-block;font-size:11px;font-weight:bold">ğŸ† ë´íŠ¸ë§µ ì¶”ì²œ</div><div style="font-weight:bold;margin-top:6px">'+s.label+'</div><div style="font-size:24px;font-weight:bold;color:#3b82f6;margin:4px 0">'+s.score+'ì  <span style="font-size:12px;color:#6b7280">'+s.grade+'ë“±ê¸‰</span></div><div style="font-size:12px;color:#4b5563;border-top:1px solid #e5e7eb;padding-top:6px">'+s.reasons.map(x=>'âœ… '+x).join('<br>')+'</div></div>');
    exploreMarkers.push(m);
  });
  const pts=[[r.lat,r.lng],...clinics.map(c=>[c.lat,c.lng]),...spots.map(s=>[s.lat,s.lng])];
  exploreMap.fitBounds(pts,{padding:[60,60]});
}

function highlightClinicCard(idx){
  document.querySelectorAll('.map-clinic-card').forEach((el,i)=>{el.classList.toggle('active',i===idx)});
  const el=document.querySelectorAll('.map-clinic-card')[idx];
  if(el)el.scrollIntoView({behavior:'smooth',block:'nearest'});
}

function focusClinicOnMap(lat,lng,idx){
  if(exploreMap)exploreMap.setView([lat,lng],17,{animate:true});
  if(exploreMarkers[idx+1])exploreMarkers[idx+1].openPopup();/*+1 because center marker is [0]*/
  highlightClinicCard(idx);
}

/* â”€â”€ Filter State â”€â”€ */
let mapFilter='total',mapSelected=null;
const filterLabels={total:'ì¢…í•© ì ìˆ˜',population:'ì¸êµ¬ë°€ë„',competition:'ê²½ìŸê°•ë„',cost:'ì„ëŒ€ë¹„ìš©',access:'ì ‘ê·¼ì„±',growth:'ì„±ì¥ì„±'};
function getFilterScore(r,f){return f==='total'?r.scores.total:r.scores[f]}

/* â”€â”€ Map Filters & Region List â”€â”€ */
function initMapFilters(){
  const fs=[{k:'total',l:'ì¢…í•©'},{k:'population',l:'ì¸êµ¬'},{k:'competition',l:'ê²½ìŸ'},{k:'cost',l:'ë¹„ìš©'},{k:'access',l:'ì ‘ê·¼ì„±'},{k:'growth',l:'ì„±ì¥ì„±'}];
  const el=document.getElementById('map-filters');if(!el)return;
  el.innerHTML='<button onclick="backToRegionList()" class="px-2.5 py-1 rounded-full text-xs font-medium bg-blue-600 text-white">ì¹˜ê³¼</button>'+fs.map(f=>'<button onclick="setMapFilter(\''+f.k+'\')" class="px-2.5 py-1 rounded-full text-xs font-medium transition border '+(mapFilter===f.k?'border-blue-600 text-blue-600 bg-blue-50':'border-gray-200 text-gray-500 hover:bg-gray-50')+'">'+f.l+'</button>').join('');
}

function setMapFilter(f){mapFilter=f;initMapFilters();if(mapCurrentRegion)selectMapRegion(mapCurrentRegion);else renderRegionList()}

function onMapSearch(){
  const v=(document.getElementById('map-search').value||'').trim();
  if(!v){mapCurrentRegion=null;renderRegionList();showAllRegionsOnMap();return}
  const matches=REGIONS.filter(r=>r.dong.includes(v)||r.sigungu.includes(v)||r.sido.includes(v));
  if(matches.length===1){selectMapRegion(matches[0]);return}
  if(matches.length>1){mapCurrentRegion=null;renderRegionList(matches);showAllRegionsOnMap();return}
  /* no match â†’ AI analyze prompt */
  document.getElementById('map-count-info').innerHTML='ã€Œ'+v+'ã€ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ';
  document.getElementById('map-list').innerHTML='<div class="flex flex-col items-center py-16 px-6 text-center"><div class="text-4xl mb-3">ğŸ”</div><p class="font-bold text-gray-800 text-lg">ã€Œ'+v+'ã€</p><p class="text-sm text-gray-500 mt-2">ê¸°ì¡´ ë°ì´í„°ì— ì—†ëŠ” ì§€ì—­ì…ë‹ˆë‹¤.<br>AIê°€ ë¶„ì„ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><button onclick="window.location.href=\'analysis.html?q='+encodeURIComponent(v)+'\'" class="mt-4 bg-blue-600 text-white font-semibold px-6 py-2.5 rounded-lg hover:bg-blue-700 transition text-sm">ã€Œ'+v+'ã€ AI ë¶„ì„ ì‹œì‘ â†’</button></div>';
}

function renderRegionList(regions){
  regions=regions||REGIONS.filter(r=>!r._generated);
  const sorted=[...regions].sort((a,b)=>getFilterScore(b,mapFilter)-getFilterScore(a,mapFilter));
  document.getElementById('map-count-info').innerHTML='<span>'+sorted.length+'ê°œ ì§€ì—­</span><span class="text-blue-600 font-medium">'+filterLabels[mapFilter]+' ìˆœ</span>';
  let h='';sorted.forEach(r=>{const sc=getFilterScore(r,mapFilter);const color=sc>=80?'#3b82f6':sc>=70?'#22c55e':sc>=60?'#eab308':'#ef4444';
    h+='<div onclick="selectMapRegion(REGIONS.find(x=>x.dong_code===\''+r.dong_code+'\'))" class="p-4 border-b border-gray-100 cursor-pointer hover:bg-blue-50 transition">'
    +'<div class="flex items-start justify-between"><div><h3 class="font-bold text-blue-700 text-[15px]">'+r.dong+'</h3><p class="text-xs text-gray-500 mt-0.5">'+r.sido+' '+r.sigungu+'</p></div><div class="px-2 py-0.5 rounded text-xs font-bold" style="background:'+color+'15;color:'+color+'">'+r.grade+'ë“±ê¸‰</div></div>'
    +'<div class="flex items-center gap-4 mt-2 text-xs text-gray-500"><span>'+filterLabels[mapFilter]+' <b class="text-gray-900">'+sc+'ì </b></span><span>ì¸êµ¬ '+(r.population/10000).toFixed(1)+'ë§Œ</span><span>ì¹˜ê³¼ <b class="text-red-500">'+r.dental_count+'</b>ê°œ</span></div>'
    +'<div class="mt-2 w-full h-1 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full" style="width:'+sc+'%;background:'+color+'"></div></div></div>'
  });
  document.getElementById('map-list').innerHTML=h;
}

function selectMapRegion(r){
  if(!r)return;mapCurrentRegion=r;mapSelected=r;
  const clinics=generateNearbyClinics(r),spots=generateRecommendedSpots(r);
  mapClinicData={clinics,spots};
  renderClinicListPanel(r,clinics,spots);
  showRegionClinicsOnMap(r,clinics,spots);
}

function renderClinicListPanel(r,clinics,spots){
  /* Build analysis link: for known regions use analysis.html?q=dong, for generated the same */
  const analysisLink='analysis.html?q='+encodeURIComponent(r.dong);
  document.getElementById('map-count-info').innerHTML='<span>'+r.dong+' ì¹˜ê³¼ '+clinics.length+'ê°œ</span><span class="text-amber-600 font-medium">ì¶”ì²œ '+spots.length+'ê³³</span>';
  let h='';
  /* region header */
  h+='<div class="p-4 bg-gradient-to-r from-blue-50 to-blue-100/50 border-b border-blue-200">'
  +'<button onclick="backToRegionList()" class="text-xs text-gray-500 hover:text-blue-600 flex items-center gap-1 mb-2"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>ì „ì²´ ì§€ì—­</button>'
  +'<div class="flex items-center justify-between"><div><h2 class="font-bold text-lg text-gray-900">'+r.dong+'</h2><p class="text-xs text-gray-500">'+r.sido+' '+r.sigungu+' Â· ì¸êµ¬ '+fmt(r.population)+'ëª… Â· ì¹˜ê³¼ '+r.dental_count+'ê°œ</p></div>'
  +'<div class="text-right"><p class="text-2xl font-bold '+getScoreColor(r.scores.total)+'">'+r.scores.total+'</p><p class="text-xs text-gray-400">'+r.grade+'ë“±ê¸‰</p></div></div>'
  +'<a href="'+analysisLink+'" class="mt-3 block text-center bg-blue-600 text-white text-sm font-semibold py-2 rounded-lg hover:bg-blue-700 transition">ìƒì„¸ ë¶„ì„ ë³´ê¸° â†’</a></div>';
  /* recommended spots */
  spots.forEach(s=>{
    h+='<div class="p-4 border-b border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50/50">'
    +'<div class="flex items-center gap-1.5 mb-1"><span class="text-sm">â­</span><span class="text-[11px] font-bold text-amber-800 bg-amber-200/80 px-2 py-0.5 rounded-full">ë´íŠ¸ë§µ ì¶”ì²œ ê°œì› ìœ„ì¹˜</span></div>'
    +'<h3 class="font-bold text-amber-900 text-sm">'+s.label+'</h3>'
    +'<div class="flex items-baseline gap-2 mt-0.5"><span class="text-xl font-bold text-blue-600">'+s.score+'ì </span><span class="text-[11px] text-gray-400">'+s.grade+'ë“±ê¸‰</span></div>'
    +'<p class="text-xs text-gray-600 mt-1">'+s.reasons.slice(0,2).join(' Â· ')+'</p>'
    +'<p class="text-[11px] text-gray-400 mt-0.5">ì˜ˆìƒ ì„ëŒ€ë£Œ '+s.rent+'ë§Œ/í‰ Â· ì£¼ë³€ì¸êµ¬ '+fmt(s.estPop)+'ëª…</p></div>';
  });
  /* clinics */
  clinics.forEach((c,i)=>{
    const stBg=c.status==='ì˜ì—…ì¤‘'?'bg-green-50 text-green-700':c.status==='íœ´ì—…'?'bg-yellow-50 text-yellow-700':'bg-red-50 text-red-700';
    const threatColor=c.competitionThreat==='ë†’ìŒ'?'text-red-600':c.competitionThreat==='ë³´í†µ'?'text-amber-600':'text-green-600';
    h+='<div class="map-clinic-card p-4 border-b border-gray-100 cursor-pointer" onclick="focusClinicOnMap('+c.lat+','+c.lng+','+i+')">'
    +'<div class="flex gap-3"><div class="flex-1 min-w-0">'
    +'<div class="flex items-center gap-1.5 flex-wrap"><h3 class="font-bold text-blue-700 text-[14px]">'+c.name+'</h3>'
    +'<span class="text-[10px] font-semibold px-1.5 py-0.5 rounded '+stBg+'">'+c.status+'</span>'
    +(c.forSale?'<span class="text-[10px] font-semibold px-1.5 py-0.5 rounded bg-purple-50 text-purple-700">ì¸ìˆ˜ê°€ëŠ¥</span>':'')+'</div>'
    +'<div class="flex flex-wrap gap-1 mt-1"><span class="text-[10px] bg-red-50 text-red-600 px-1.5 py-0.5 rounded">'+c.type+'</span>'
    +'<span class="text-[10px] bg-sky-50 text-sky-700 px-1.5 py-0.5 rounded">'+c.priceLevel+'</span>'
    +'<span class="text-[10px] bg-violet-50 text-violet-700 px-1.5 py-0.5 rounded">'+nightWeekendLabel(c.nightWeekend)+'</span></div>'
    +'<p class="text-xs text-gray-500 mt-1">'+c.director+' Â· '+c.estYear+'ë…„ ê°œì› ('+c.yearsOpen+'ë…„ì°¨)</p>'
    +'<p class="text-xs text-gray-400">'+c.floor+' Â· '+c.size+(c.hasParking?' Â· ğŸ…¿ï¸':'')+'</p>'
    +'<div class="flex items-center gap-2 mt-1"><span class="text-xs text-yellow-600">â˜… '+c.naverRating+' ('+fmt(c.naverReviewCount)+')</span><span class="text-xs text-gray-400">ì²´ì–´ '+c.chairs+'ëŒ€</span></div>'
    +'<div class="flex items-center gap-2 mt-0.5"><span class="text-xs text-gray-500">ì˜ì‚¬ '+c.dentistCount+' Â· ìœ„ìƒì‚¬ '+c.hygienistCount+' Â· ì´ '+c.totalStaff+'ëª…</span></div>'
    +'<div class="flex items-center gap-2 mt-0.5"><span class="text-xs text-gray-500">ì¼ '+c.dailyPatients+'ëª… Â· ë³´í—˜ '+fmt(c.insuranceClaims)+'ê±´/ì›” Â· ë¹„ê¸‰ì—¬ '+c.nonCoverageRatio+'%</span></div>'
    +'<div class="flex flex-wrap gap-1 mt-1">'+c.specialties.map(function(sp){return '<span class="text-[10px] bg-emerald-50 text-emerald-700 px-1 py-0.5 rounded">'+sp+'</span>'}).join('')+'</div>'
    +'<div class="flex items-center gap-2 mt-1.5">'
    +'<span class="text-[11px] font-semibold text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded">ì—° '+fmtRevKr(c.annualRevenue)+'ì›</span>'
    +'<span class="text-[11px] font-semibold text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded">ì›” '+fmtRevKr(c.monthlyRevenue)+'ì›</span></div>'
    +'<div class="flex items-center gap-2 mt-0.5"><span class="text-[10px] '+threatColor+' font-medium">ê²½ìŸìœ„í˜‘ '+c.competitionThreat+'</span><span class="text-[10px] text-gray-400">ë™ì¢… '+c.sameTypeNearby+'ê°œ Â· ë¸”ë¡œê·¸ '+fmt(c.blogExposure)+'ê±´</span></div>'
    +(c.forSale&&c.estimatedAcquisitionPrice?'<div class="mt-1"><span class="text-[11px] font-bold text-purple-700 bg-purple-50 px-1.5 py-0.5 rounded">ì˜ˆìƒ ì¸ìˆ˜ê°€ ì•½ '+fmtRevKr(c.estimatedAcquisitionPrice)+'ì›</span></div>':'')
    +'</div><div class="w-[52px] h-[52px] rounded-lg flex items-center justify-center text-2xl shrink-0 '+(c.status==='ì˜ì—…ì¤‘'?'bg-red-50':'bg-gray-100')+'">ğŸ¦·</div></div>'
    +'<div class="flex gap-1.5 mt-2.5">'
    +'<button onclick="event.stopPropagation();focusClinicOnMap('+c.lat+','+c.lng+','+i+')" class="text-[11px] border border-gray-200 text-gray-600 rounded-full px-2.5 py-1 hover:bg-gray-50">ğŸ“ ìœ„ì¹˜</button>'
    +'<button class="text-[11px] border border-blue-200 text-blue-600 rounded-full px-2.5 py-1 hover:bg-blue-50">ğŸ—ºï¸ ë„ì°©</button>'
    +'<button class="text-[11px] border border-gray-200 text-gray-600 rounded-full px-2.5 py-1 hover:bg-gray-50">ğŸ“ ë¬¸ì˜</button>'
    +'</div></div>';
  });
  document.getElementById('map-list').innerHTML=h;
}

function backToRegionList(){mapCurrentRegion=null;mapSelected=null;document.getElementById('map-search').value='';renderRegionList();showAllRegionsOnMap()}

/* â”€â”€ Init on page load â”€â”€ */
document.addEventListener('DOMContentLoaded',function(){
  initMapFilters();
  renderRegionList();
  renderExploreMap();
});
</script>

<!-- FOOTER -->
<footer class="bg-gray-900 text-gray-400 py-12"><div class="max-w-7xl mx-auto px-6">
<div class="grid md:grid-cols-4 gap-8">
<div><div class="flex items-center gap-2 mb-3"><div class="w-7 h-7 bg-blue-600 rounded-lg flex items-center justify-center"><span class="text-white font-bold text-xs">D</span></div><span class="font-bold text-white">ë´íŠ¸ë§µAI <span class="text-sm font-medium text-gray-300">ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„</span></span></div><p class="text-sm">ë°ì´í„°ë¡œ ì°¾ëŠ” ìµœì ì˜ ì¹˜ê³¼ ê°œì› ì…ì§€</p></div>
<div><h3 class="text-white font-semibold mb-3 text-sm">ì„œë¹„ìŠ¤</h3><div class="space-y-2 text-sm"><a href="analysis.html" class="block hover:text-white transition">ì…ì§€ë¶„ì„</a><a href="map.html" class="block hover:text-white transition">ì§€ë„ íƒìƒ‰</a><a href="pricing.html" class="block hover:text-white transition">ìš”ê¸ˆì œ</a></div></div>
<div><h3 class="text-white font-semibold mb-3 text-sm">ì§€ì›</h3><div class="space-y-2 text-sm"><a href="faq.html" class="block hover:text-white transition">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</a><a href="manual.html" class="block hover:text-white transition">ì‚¬ìš©ì ë§¤ë‰´ì–¼</a><a href="index.html" class="block hover:text-white transition">í™ˆìœ¼ë¡œ</a></div></div>
<div><h3 class="text-white font-semibold mb-3 text-sm">ì—°ë½ì²˜</h3><div class="space-y-2 text-sm"><p>ì‹¬ì¬ìš° ëŒ€í‘œ</p><p><a href="mailto:jaiwshim@gmail.com" class="hover:text-white">jaiwshim@gmail.com</a></p><p><a href="tel:010-2397-5734" class="hover:text-white">010-2397-5734</a></p></div></div>
</div>
<div class="border-t border-gray-800 mt-8 pt-8 text-xs"><p>ë´íŠ¸ë§µAI ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„ | ì‹¬ì¬ìš° ëŒ€í‘œ</p><p class="mt-1">ë¬¸ì˜: <a href="mailto:jaiwshim@gmail.com" class="text-gray-400 hover:text-white">jaiwshim@gmail.com</a> Â· <a href="tel:010-2397-5734" class="text-gray-400 hover:text-white">010-2397-5734</a></p><p class="mt-2">&copy; 2025 DentMap. All rights reserved.</p><p class="mt-2 text-gray-600">ë³¸ ì„œë¹„ìŠ¤ì˜ ë¶„ì„ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, íˆ¬ì ê²°ì •ì— ëŒ€í•œ ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.</p></div>
</div></footer>

</body>
</html>
