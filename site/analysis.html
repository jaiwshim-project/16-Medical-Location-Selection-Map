<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì…ì§€ ë¶„ì„ â€” ë´íƒˆë§µAI ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
<script>tailwind.config={theme:{extend:{fontFamily:{sans:['Pretendard Variable','Pretendard','system-ui','sans-serif']}}}}</script>
<style>html{scroll-behavior:smooth}body{font-family:'Pretendard Variable',sans-serif}input[type=range]{cursor:pointer}</style>
</head>
<body class="antialiased bg-white text-gray-900">
<div id="test-banner"></div>
<div id="app-header"></div>
<div id="analysis-content"></div>
<div id="app-footer"></div>
<script src="shared.js"></script>
<script>
initPage('map');

let analysisState={tab:'overview',generating:false,generated:false};
let invState={};

function getInv(r){
  if(!invState[r.dong_code])invState[r.dong_code]={pyeong:r.area_pyeong,deposit:r.avg_rent_pyeong*r.area_pyeong*10,interior:r.area_pyeong*200,equipment:12000,operating:3000};
  return invState[r.dong_code];
}

function loadAnalysis(){
  const hash=location.hash.slice(1);
  if(!hash){
    document.getElementById('analysis-content').innerHTML='<div class="min-h-[60vh] flex items-center justify-center"><div class="text-center"><p class="text-4xl mb-4">ğŸ”</p><p class="text-gray-500">ë¶„ì„í•  ì§€ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</p><a href="map.html" class="text-blue-600 mt-3 inline-block hover:underline">&larr; ì§€ë„ë¡œ ëŒì•„ê°€ê¸°</a></div></div>';
    return;
  }
  const r=resolveRegionFromHash(hash);
  if(!r){
    document.getElementById('analysis-content').innerHTML='<div class="min-h-[60vh] flex items-center justify-center"><div class="text-center"><p class="text-4xl mb-4">ğŸ”</p><p class="text-gray-500">í•´ë‹¹ ì§€ì—­ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p><a href="map.html" class="text-blue-600 mt-3 inline-block hover:underline">&larr; ì§€ë„ë¡œ ëŒì•„ê°€ê¸°</a></div></div>';
    return;
  }
  analysisState={tab:'overview',generating:false,generated:false};
  renderAnalysisContent(r);
}

function renderAnalysisContent(r){
  const texts=genTexts(r);
  const tab=analysisState.tab;
  let tabContent='';
  if(tab==='overview')tabContent=buildOverviewTab(r,texts);
  else if(tab==='investment')tabContent=buildInvestmentTab(r);
  else tabContent=buildReportTab(r,texts);

  const loc=r.sido?r.sido+' '+r.sigungu+' ':'';
  document.getElementById('analysis-content').innerHTML='<div class="max-w-6xl mx-auto px-6 py-8">'
    +'<div class="flex items-center justify-between mb-6"><div class="flex items-center gap-2 text-sm text-gray-400"><a href="map.html" class="hover:text-blue-600 transition">ì§€ë„ íƒìƒ‰</a><span>/</span><span class="text-gray-700">'+(function(){var p=[];if(r.sido)p.push(r.sido);if(r.sigungu&&r.sigungu!==r.dong)p.push(r.sigungu);p.push(r.dong);return p.join(' ')})()+'</span></div><div class="flex items-center gap-2"><input id="analysis-quick-input" type="text" placeholder="ë‹¤ë¥¸ ì§€ì—­ ì…ë ¥" class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-600 outline-none w-40" onkeydown="if(event.key===\'Enter\')analyzeFromInput()"><button onclick="analyzeFromInput()" class="bg-blue-600 text-white text-sm font-medium px-3 py-1.5 rounded-lg hover:bg-blue-700 transition">ë¶„ì„</button></div></div>'
    +'<div class="flex flex-col md:flex-row md:items-end justify-between gap-4 mb-8"><div><p class="text-sm text-gray-400">'+loc+'</p><h1 class="text-3xl font-bold text-gray-900">'+r.dong+' ì…ì§€ ë¶„ì„</h1></div><div class="flex items-center gap-3"><div class="px-4 py-2 rounded-xl text-lg font-bold '+getGradeColor(r.grade)+'">ì¢…í•© '+r.scores.total+'ì  &middot; '+r.grade+'ë“±ê¸‰</div></div></div>'
    +'<div class="border-b border-gray-200 mb-8"><div class="flex gap-1">'
    +'<button onclick="switchTab(\'overview\',\''+r.dong_code+'\')" class="px-5 py-3 text-sm font-semibold border-b-2 transition '+(tab==='overview'?'border-blue-600 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700')+'">ì¢…í•© ë¶„ì„</button>'
    +'<button onclick="switchTab(\'investment\',\''+r.dong_code+'\')" class="px-5 py-3 text-sm font-semibold border-b-2 transition '+(tab==='investment'?'border-blue-600 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700')+'">íˆ¬ì ì‹œë®¬ë ˆì´í„°</button>'
    +'<button onclick="switchTab(\'report\',\''+r.dong_code+'\')" class="px-5 py-3 text-sm font-semibold border-b-2 transition '+(tab==='report'?'border-blue-600 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700')+'">AI ì…ì§€ë¶„ì„ ë¦¬í¬íŠ¸</button>'
    +'</div></div>'
    +tabContent
    +'</div>';
}

function switchTab(tab,code){
  const r=REGIONS.find(x=>x.dong_code===code);
  if(!r)return;
  analysisState.tab=tab;
  renderAnalysisContent(r);
}

function analyzeFromInput(){
  const input=document.getElementById('analysis-quick-input');
  const name=(input?input.value:'').trim();
  if(!name)return;
  const existing=REGIONS.find(r=>r.dong.includes(name)||r.sigungu.includes(name));
  if(existing){location.hash=existing.dong_code;loadAnalysis();return}
  location.hash='gen:'+encodeURIComponent(name);
  loadAnalysis();
}

/* â”€â”€ Overview Tab â”€â”€ */
function buildOverviewTab(r,texts){
  const axes=[{key:'population',label:'ì¸êµ¬/ìˆ˜ìš”',icon:'ğŸ‘¥',score:r.scores.population,text:texts.popText},{key:'competition',label:'ê²½ìŸ í™˜ê²½',icon:'ğŸ¥',score:r.scores.competition,text:texts.compText},{key:'cost',label:'ë¹„ìš© íš¨ìœ¨',icon:'ğŸ’°',score:r.scores.cost,text:texts.costText},{key:'access',label:'ì ‘ê·¼ì„±',icon:'ğŸš‡',score:r.scores.access,text:texts.accessText},{key:'growth',label:'ì„±ì¥ì„±',icon:'ğŸ“ˆ',score:r.scores.growth,text:texts.growthText}];

  let h='<div class="space-y-8"><div class="grid grid-cols-2 md:grid-cols-5 gap-4">';
  axes.forEach(a=>{h+='<div class="bg-white rounded-xl border border-gray-100 p-4 text-center shadow-sm"><p class="text-2xl">'+a.icon+'</p><p class="text-xs text-gray-500 mt-1">'+a.label+'</p><p class="text-2xl font-bold mt-1 '+getScoreColor(a.score)+'">'+a.score+'</p><div class="mt-2 w-full h-1.5 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full '+getScoreBarColor(a.score)+'" style="width:'+a.score+'%"></div></div></div>'});
  h+='</div>';

  h+='<div class="grid md:grid-cols-4 gap-4">';
  [{l:"ê±°ì£¼ì¸êµ¬",v:fmt(r.population)+"ëª…",s:"20~39ì„¸ "+r.age_20_39_pct+"%"},{l:"ì¹˜ê³¼ ìˆ˜ / ì¸êµ¬ë‹¹",v:r.dental_count+"ê°œ",s:"1:"+fmt(r.pop_per_clinic)},{l:"í‰ê·  ì„ëŒ€ë£Œ",v:r.avg_rent_pyeong+"ë§Œ/í‰",s:r.area_pyeong+"í‰ ê¸°ì¤€ ì›” "+fmt(r.avg_rent_pyeong*r.area_pyeong)+"ë§Œ"},{l:"ì¼ ìœ ë™ì¸êµ¬",v:fmt(r.daily_floating)+"ëª…",s:r.subway_station+" ë„ë³´ "+r.subway_walk_min+"ë¶„"}].forEach(i=>{h+='<div class="bg-gray-50 rounded-xl p-4"><p class="text-xs text-gray-500">'+i.l+'</p><p class="text-xl font-bold text-gray-900 mt-1">'+i.v+'</p><p class="text-xs text-gray-400 mt-1">'+i.s+'</p></div>'});
  h+='</div>';

  h+='<div class="space-y-4"><h2 class="text-lg font-bold text-gray-900">5ì¶• ìƒì„¸ ë¶„ì„</h2>';
  axes.forEach(a=>{h+='<div class="bg-white rounded-xl border border-gray-100 p-5 shadow-sm"><div class="flex items-center justify-between mb-2"><div class="flex items-center gap-2"><span class="text-xl">'+a.icon+'</span><h3 class="font-bold text-gray-900">'+a.label+'</h3></div><span class="text-lg font-bold '+getScoreColor(a.score)+'">'+a.score+'ì </span></div><div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden mb-3"><div class="h-full rounded-full '+getScoreBarColor(a.score)+'" style="width:'+a.score+'%"></div></div><p class="text-sm text-gray-600 leading-relaxed">'+a.text+'</p></div>'});
  h+='</div></div>';
  return h;
}

/* â”€â”€ Investment Tab â”€â”€ */
function buildInvestmentTab(r){
  const s=getInv(r);
  const py=s.pyeong;
  const monthlyRent=r.avg_rent_pyeong*py;
  const maintenance=Math.round(py*5);
  const labor=py<=30?800:py<=45?1500:2200;
  const dailyPatients=Math.round(r.population/Math.max(r.dental_count,1)/120);
  const unitPrice=15;
  const monthlyRevenue=dailyPatients*unitPrice*25;
  const materialCost=Math.round(monthlyRevenue*0.15);
  const otherFixed=300;
  const totalInvestment=s.deposit+s.interior+s.equipment+s.operating;
  const totalMonthlyCost=monthlyRent+maintenance+labor+materialCost+otherFixed;
  const monthlyProfit=monthlyRevenue-totalMonthlyCost;
  const breakeven=monthlyProfit>0?Math.ceil(totalInvestment/monthlyProfit):999;
  const scenarios={opt:Math.max(1,Math.round(breakeven*0.75)),base:breakeven,cons:Math.round(breakeven*1.4)};

  let chart='';
  const chartLen=Math.min(36,scenarios.cons+6);
  for(let i=1;i<=chartLen;i++){
    const cum=-totalInvestment+monthlyProfit*i;
    const maxAbs=Math.max(totalInvestment,Math.abs(cum));
    const h=Math.abs(cum)/maxAbs*100;
    chart+='<div class="flex-1 flex flex-col justify-end items-center" title="'+i+'ê°œì›”: '+fmt(Math.round(cum))+'ë§Œì›"><div class="w-full rounded-t transition-all '+(cum>=0?'bg-blue-400':'bg-red-300')+'" style="height:'+Math.max(4,h*0.8)+'%"></div></div>';
  }

  return '<div class="space-y-8">'
    +'<div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h2 class="font-bold text-gray-900 mb-4">ë©´ì  ì„¤ì •</h2><div class="flex items-center gap-4"><span class="text-sm text-gray-500 w-12">20í‰</span><input type="range" min="20" max="80" value="'+py+'" oninput="updateInvPyeong(\''+r.dong_code+'\',this.value)" class="flex-1 accent-blue-600"><span class="text-sm text-gray-500 w-12">80í‰</span></div><p class="text-center mt-2 text-lg font-bold text-blue-600">'+py+'í‰</p><p class="text-center text-xs text-gray-400">ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì •í•˜ë©´ ëª¨ë“  ê¸ˆì•¡ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤</p></div>'
    +'<div class="grid md:grid-cols-2 gap-6">'
    +'<div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h2 class="font-bold text-gray-900 mb-4">ì´ˆê¸° íˆ¬ìê¸ˆ</h2><div class="space-y-4">'
    +'<div class="flex items-center justify-between"><span class="text-sm text-gray-600">ë³´ì¦ê¸ˆ</span><div class="flex items-center gap-1"><input type="number" value="'+s.deposit+'" onchange="updateInvField(\''+r.dong_code+'\',\'deposit\',this.value)" class="w-28 text-right px-2 py-1 border border-gray-200 rounded text-sm font-medium focus:ring-2 focus:ring-blue-600 outline-none"><span class="text-xs text-gray-400">ë§Œì›</span></div></div>'
    +'<div class="flex items-center justify-between"><span class="text-sm text-gray-600">ì¸í…Œë¦¬ì–´</span><div class="flex items-center gap-1"><input type="number" value="'+s.interior+'" onchange="updateInvField(\''+r.dong_code+'\',\'interior\',this.value)" class="w-28 text-right px-2 py-1 border border-gray-200 rounded text-sm font-medium focus:ring-2 focus:ring-blue-600 outline-none"><span class="text-xs text-gray-400">ë§Œì›</span></div></div>'
    +'<div class="flex items-center justify-between"><span class="text-sm text-gray-600">ì˜ë£Œì¥ë¹„</span><div class="flex items-center gap-1"><input type="number" value="'+s.equipment+'" onchange="updateInvField(\''+r.dong_code+'\',\'equipment\',this.value)" class="w-28 text-right px-2 py-1 border border-gray-200 rounded text-sm font-medium focus:ring-2 focus:ring-blue-600 outline-none"><span class="text-xs text-gray-400">ë§Œì›</span></div></div>'
    +'<div class="flex items-center justify-between"><span class="text-sm text-gray-600">ìš´ì˜ìê¸ˆ (3ê°œì›”)</span><div class="flex items-center gap-1"><input type="number" value="'+s.operating+'" onchange="updateInvField(\''+r.dong_code+'\',\'operating\',this.value)" class="w-28 text-right px-2 py-1 border border-gray-200 rounded text-sm font-medium focus:ring-2 focus:ring-blue-600 outline-none"><span class="text-xs text-gray-400">ë§Œì›</span></div></div>'
    +'<hr class="border-gray-100"><div class="flex items-center justify-between font-bold"><span class="text-gray-900">í•©ê³„</span><span class="text-blue-600 text-lg">'+fmt(totalInvestment)+'ë§Œì›</span></div>'
    +'<p class="text-xs text-gray-400 text-right">ì•½ '+(totalInvestment/10000).toFixed(1)+'ì–µì›</p>'
    +'</div></div>'
    +'<div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h2 class="font-bold text-gray-900 mb-4">ì›”ê°„ ì†ìµ ì˜ˆì¸¡</h2><div class="space-y-3">'
    +'<div class="bg-green-50 rounded-lg p-3"><div class="flex items-center justify-between"><span class="text-sm text-green-700 font-medium">ì˜ˆìƒ ì›”ë§¤ì¶œ</span><span class="font-bold text-green-700">'+fmt(monthlyRevenue)+'ë§Œì›</span></div><p class="text-xs text-green-600 mt-1">ì¼ í™˜ì '+dailyPatients+'ëª… &times; ê°ë‹¨ê°€ '+unitPrice+'ë§Œì› &times; 25ì¼</p></div>'
    +'<div class="flex items-center justify-between text-sm"><span class="text-gray-600">(-) ì„ëŒ€ë£Œ</span><span class="text-red-500 font-medium">'+fmt(monthlyRent)+'ë§Œì›</span></div>'
    +'<div class="flex items-center justify-between text-sm"><span class="text-gray-600">(-) ê´€ë¦¬ë¹„</span><span class="text-red-500 font-medium">'+fmt(maintenance)+'ë§Œì›</span></div>'
    +'<div class="flex items-center justify-between text-sm"><span class="text-gray-600">(-) ì¸ê±´ë¹„</span><span class="text-red-500 font-medium">'+fmt(labor)+'ë§Œì›</span></div>'
    +'<div class="flex items-center justify-between text-sm"><span class="text-gray-600">(-) ì¬ë£Œë¹„ (ë§¤ì¶œ 15%)</span><span class="text-red-500 font-medium">'+fmt(materialCost)+'ë§Œì›</span></div>'
    +'<div class="flex items-center justify-between text-sm"><span class="text-gray-600">(-) ê¸°íƒ€ ê³ ì •ë¹„</span><span class="text-red-500 font-medium">'+fmt(otherFixed)+'ë§Œì›</span></div>'
    +'<hr class="border-gray-100"><div class="flex items-center justify-between font-bold text-lg"><span>ì›” ìˆœì´ìµ</span><span class="'+(monthlyProfit>0?'text-blue-600':'text-red-500')+'">'+(monthlyProfit>0?'+':'')+fmt(monthlyProfit)+'ë§Œì›</span></div>'
    +'</div></div></div>'
    +'<div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h2 class="font-bold text-gray-900 mb-4">ì†ìµë¶„ê¸° ë¶„ì„</h2>'
    +'<div class="grid grid-cols-3 gap-4 mb-6">'
    +'<div class="rounded-xl p-4 text-center text-green-600 bg-green-50"><p class="text-xs font-medium">ë‚™ê´€ì  ì‹œë‚˜ë¦¬ì˜¤</p><p class="text-3xl font-bold mt-1">'+scenarios.opt+'</p><p class="text-xs">ê°œì›”</p></div>'
    +'<div class="rounded-xl p-4 text-center text-blue-600 bg-blue-50"><p class="text-xs font-medium">ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤</p><p class="text-3xl font-bold mt-1">'+scenarios.base+'</p><p class="text-xs">ê°œì›”</p></div>'
    +'<div class="rounded-xl p-4 text-center text-orange-600 bg-orange-50"><p class="text-xs font-medium">ë³´ìˆ˜ì  ì‹œë‚˜ë¦¬ì˜¤</p><p class="text-3xl font-bold mt-1">'+scenarios.cons+'</p><p class="text-xs">ê°œì›”</p></div>'
    +'</div>'
    +'<div class="h-48 flex items-end gap-1">'+chart+'</div>'
    +'<div class="flex justify-between text-xs text-gray-400 mt-2"><span>1ê°œì›”</span><span>'+chartLen+'ê°œì›”</span></div>'
    +'<p class="text-xs text-gray-400 text-center mt-1">íŒŒë€ìƒ‰ = í‘ì / ë¹¨ê°„ìƒ‰ = ì ì (ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ê¸ˆì•¡ í™•ì¸)</p></div>'
    +'<p class="text-xs text-gray-400 text-center">* ê¸ˆì•¡ì„ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ë¹„ìš©ì€ ì§€ì—­Â·ì—…ì²´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div>';
}

function updateInvPyeong(code,val){
  const r=REGIONS.find(x=>x.dong_code===code);if(!r)return;
  const s=getInv(r);s.pyeong=Number(val);
  renderAnalysisContent(r);
}
function updateInvField(code,field,val){
  const r=REGIONS.find(x=>x.dong_code===code);if(!r)return;
  const s=getInv(r);s[field]=Number(val);
  renderAnalysisContent(r);
}

/* â”€â”€ Report Tab â”€â”€ */
function buildReportTab(r,texts){
  if(!analysisState.generated){
    return '<div class="text-center py-20"><p class="text-5xl mb-4">ğŸ“‹</p><h2 class="text-xl font-bold text-gray-900">AI ì…ì§€ë¶„ì„ ë¦¬í¬íŠ¸</h2><p class="text-gray-500 mt-2 leading-relaxed">5ì¶• ë¶„ì„ê³¼ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ì„ ì¢…í•©í•˜ì—¬<br>AIê°€ ë§ì¶¤í˜• ê²°ì • ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><button onclick="generateReport(\''+r.dong_code+'\')" '+(analysisState.generating?'disabled':'')+' class="mt-6 bg-blue-600 text-white font-semibold px-8 py-3 rounded-xl hover:bg-blue-700 transition disabled:opacity-50">'+(analysisState.generating?'<span class="flex items-center gap-2"><svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"/></svg>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</span>':'AI ì…ì§€ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±')+'</button></div>';
  }

  const ts=r.scores.total;
  const sl=ts>=80?'ë§¤ìš° ìœ ë§':ts>=70?'ì¶”ì²œ':ts>=60?'ì¡°ê±´ë¶€ ì¶”ì²œ':'ì£¼ì˜ í•„ìš”';
  const dep=r.avg_rent_pyeong*r.area_pyeong*10,intr=r.area_pyeong*200,eq=12000,ti=dep+intr+eq+3000;
  const mr=r.avg_rent_pyeong*r.area_pyeong;
  const dp=Math.round(r.population/Math.max(r.dental_count,1)/120);
  const mRev=dp*15*25;
  const mProf=mRev-mr-800-Math.round(mRev*0.15)-300-Math.round(r.area_pyeong*5);
  const be=mProf>0?Math.ceil(ti/mProf):999;

  const execSum=ts>=80?(function(){var p=[];if(r.sido)p.push(r.sido);if(r.sigungu&&r.sigungu!==r.dong)p.push(r.sigungu);p.push(r.dong);return p.join(' ')})()+'ì—ì„œì˜ ì¹˜ê³¼ ê°œì›ì€ ë§¤ìš° ìœ ë§í•©ë‹ˆë‹¤. íˆ¬ìê¸ˆ ì•½ '+(ti/10000).toFixed(1)+'ì–µ ëŒ€ë¹„ '+be+'ê°œì›” ë‚´ ì†ìµë¶„ê¸°ê°€ ê¸°ëŒ€ë©ë‹ˆë‹¤.':ts>=70?r.dong+'ì€ ê°œì›ì— ì í•©í•œ ì…ì§€ì…ë‹ˆë‹¤. ì›” ë§¤ì¶œ '+fmt(mRev)+'ë§Œì›ì´ í˜„ì‹¤ì ìœ¼ë¡œ ê¸°ëŒ€ë©ë‹ˆë‹¤.':r.dong+'ì—ì„œì˜ ê°œì›ì€ ê°€ëŠ¥í•˜ë‚˜, ë³´ìˆ˜ì  ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” '+Math.round(be*1.4)+'ê°œì›”ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';

  const scoreAxes=[{l:'ì¸êµ¬/ìˆ˜ìš”',s:r.scores.population},{l:'ê²½ìŸ í™˜ê²½',s:r.scores.competition},{l:'ë¹„ìš© íš¨ìœ¨',s:r.scores.cost},{l:'ì ‘ê·¼ì„±',s:r.scores.access},{l:'ì„±ì¥ì„±',s:r.scores.growth}];
  const detailAxes=[{l:'ì¸êµ¬/ìˆ˜ìš”',s:r.scores.population,t:texts.popText},{l:'ê²½ìŸ í™˜ê²½',s:r.scores.competition,t:texts.compText},{l:'ë¹„ìš© íš¨ìœ¨',s:r.scores.cost,t:texts.costText},{l:'ì ‘ê·¼ì„±',s:r.scores.access,t:texts.accessText},{l:'ì„±ì¥ì„±',s:r.scores.growth,t:texts.growthText}];

  let risks='';
  if(r.scores.competition<60)risks+='<div class="bg-red-50 rounded-lg p-3 text-sm text-red-800">ë°˜ê²½ 500m ë‚´ ì¹˜ê³¼ '+r.dental_count+'ê°œë¡œ ê²½ìŸì´ ì¹˜ì—´í•©ë‹ˆë‹¤.</div>';
  if(r.scores.cost<60)risks+='<div class="bg-red-50 rounded-lg p-3 text-sm text-red-800">í‰ë‹¹ '+r.avg_rent_pyeong+'ë§Œì›ì˜ ë†’ì€ ì„ëŒ€ë£Œë¡œ ê³ ì •ë¹„ ë¶€ë‹´ì´ í½ë‹ˆë‹¤.</div>';
  if(r.pop_growth_rate<1)risks+='<div class="bg-red-50 rounded-lg p-3 text-sm text-red-800">ì¸êµ¬ ì¦ê°€ìœ¨ '+r.pop_growth_rate+'%ë¡œ ì¤‘ì¥ê¸° ì„±ì¥ì´ ì œí•œì ì…ë‹ˆë‹¤.</div>';
  if(!risks)risks='<div class="bg-yellow-50 rounded-lg p-3 text-sm text-yellow-800">ì „ë°˜ì ìœ¼ë¡œ ë¦¬ìŠ¤í¬ê°€ ë‚®ìœ¼ë‚˜, ê²½ê¸° ë³€ë™ì— ìœ ì˜í•˜ì„¸ìš”.</div>';

  let opps='';
  if(r.scores.population>=70)opps+='<div class="bg-green-50 rounded-lg p-3 text-sm text-green-800">ê±°ì£¼ì¸êµ¬ '+fmt(r.population)+'ëª…, ìœ ë™ì¸êµ¬ '+fmt(r.daily_floating)+'ëª…ìœ¼ë¡œ ìˆ˜ìš” ê¸°ë°˜ì´ íƒ„íƒ„í•©ë‹ˆë‹¤.</div>';
  if(r.pop_growth_rate>=3)opps+='<div class="bg-green-50 rounded-lg p-3 text-sm text-green-800">ì¸êµ¬ ì¦ê°€ìœ¨ +'+r.pop_growth_rate+'%ë¡œ ì„±ì¥ ì ì¬ë ¥ì´ ë†’ìŠµë‹ˆë‹¤.</div>';
  if(r.age_20_39_pct>=35)opps+='<div class="bg-green-50 rounded-lg p-3 text-sm text-green-800">20~39ì„¸ ë¹„ìœ¨ '+r.age_20_39_pct+'%ë¡œ ê³ ë‹¨ê°€ ì§„ë£Œ ìˆ˜ìš”ê°€ í’ë¶€í•©ë‹ˆë‹¤.</div>';

  return '<div class="max-w-3xl mx-auto space-y-8">'
    +'<div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-8 text-white"><div class="flex items-center justify-between mb-4"><p class="text-blue-200 text-sm">AI ì…ì§€ë¶„ì„ ë¦¬í¬íŠ¸</p><p class="text-blue-200 text-xs">'+new Date().toLocaleDateString('ko-KR')+'</p></div><h2 class="text-2xl font-bold">'+(function(){var p=[];if(r.sido)p.push(r.sido);if(r.sigungu&&r.sigungu!==r.dong)p.push(r.sigungu);p.push(r.dong);return p.join(' ')})()+'</h2><p class="mt-1 text-blue-100">ì¢…í•© '+ts+'ì  ('+r.grade+'ë“±ê¸‰) &mdash; '+sl+'</p></div>'
    +'<section class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h3 class="font-bold text-gray-900 flex items-center gap-2 mb-3"><span class="text-blue-600">01</span> í•œ ì¤„ íŒì •</h3><div class="bg-blue-50 rounded-lg p-4"><p class="text-gray-800 leading-relaxed font-medium">'+execSum+'</p></div></section>'
    +'<section class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h3 class="font-bold text-gray-900 flex items-center gap-2 mb-4"><span class="text-blue-600">02</span> ì¢…í•© ì ìˆ˜</h3><div class="flex items-center gap-6 mb-4"><div class="text-center"><p class="text-5xl font-bold '+getScoreColor(ts)+'">'+ts+'</p><p class="text-sm text-gray-500 mt-1">'+r.grade+'ë“±ê¸‰</p></div><div class="flex-1 space-y-2">'+scoreAxes.map(a=>'<div class="flex items-center gap-2"><span class="text-xs text-gray-500 w-16">'+a.l+'</span><div class="flex-1 h-2 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full '+getScoreBarColor(a.s)+'" style="width:'+a.s+'%"></div></div><span class="text-xs font-bold w-8 text-right '+getScoreColor(a.s)+'">'+a.s+'</span></div>').join('')+'</div></div></section>'
    +'<section class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h3 class="font-bold text-gray-900 flex items-center gap-2 mb-4"><span class="text-blue-600">03</span> 5ì¶• ìƒì„¸ ë¶„ì„</h3><div class="space-y-4">'+detailAxes.map(a=>'<div class="border-l-4 border-blue-100 pl-4 py-2"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-sm text-gray-900">'+a.l+'</span><span class="text-xs font-bold px-2 py-0.5 rounded '+getGradeColor(a.s>=80?'A':a.s>=60?'B':'C')+'">'+a.s+'ì </span></div><p class="text-sm text-gray-600 leading-relaxed">'+a.t+'</p></div>').join('')+'</div></section>'
    +'<section class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h3 class="font-bold text-gray-900 flex items-center gap-2 mb-4"><span class="text-blue-600">04</span> íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ ìš”ì•½</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">'
    +'<div class="bg-gray-50 rounded-lg p-3 text-center"><p class="text-xs text-gray-500">ì´ íˆ¬ìê¸ˆ</p><p class="text-lg font-bold">'+(ti/10000).toFixed(1)+'ì–µ</p></div>'
    +'<div class="bg-gray-50 rounded-lg p-3 text-center"><p class="text-xs text-gray-500">ì˜ˆìƒ ì›”ë§¤ì¶œ</p><p class="text-lg font-bold text-green-600">'+fmt(mRev)+'ë§Œ</p></div>'
    +'<div class="bg-gray-50 rounded-lg p-3 text-center"><p class="text-xs text-gray-500">ì›” ìˆœì´ìµ</p><p class="text-lg font-bold text-blue-600">'+fmt(mProf)+'ë§Œ</p></div>'
    +'<div class="bg-gray-50 rounded-lg p-3 text-center"><p class="text-xs text-gray-500">ì†ìµë¶„ê¸°</p><p class="text-lg font-bold">'+be+'ê°œì›”</p></div>'
    +'</div></section>'
    +'<section class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm"><h3 class="font-bold text-gray-900 flex items-center gap-2 mb-4"><span class="text-blue-600">05</span> í•µì‹¬ ë¦¬ìŠ¤í¬ & ê¸°íšŒ</h3><div class="grid md:grid-cols-2 gap-4"><div><p class="font-semibold text-red-600 text-sm mb-2">ë¦¬ìŠ¤í¬</p><div class="space-y-2">'+risks+'</div></div><div><p class="font-semibold text-green-600 text-sm mb-2">ê¸°íšŒ</p><div class="space-y-2">'+opps+'</div></div></div></section>'
    +'<div class="bg-gray-50 rounded-xl p-4 text-xs text-gray-400 leading-relaxed">ë³¸ ë¦¬í¬íŠ¸ëŠ” ê³µê³µë°ì´í„° ë° í†µê³„ ëª¨ë¸ì— ê¸°ë°˜í•œ ì°¸ê³  ìë£Œì´ë©°, ì‹¤ì œ ê°œì› ê²°ì •ì— ëŒ€í•œ ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>ë°ì´í„° ê¸°ì¤€ì¼: 2025.01 | ë¶„ì„ ëª¨ë¸ v1.0 | &copy; DentalMap</div>'
    +'<div class="flex flex-col sm:flex-row gap-3 justify-center pb-8">'
    +'<button class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition">PDF ë‹¤ìš´ë¡œë“œ</button>'
    +'<button class="border border-gray-300 text-gray-700 font-semibold px-6 py-3 rounded-lg hover:bg-gray-50 transition">ê³µìœ  ë§í¬ ë³µì‚¬</button>'
    +'<a href="map.html" class="border border-gray-300 text-gray-700 font-semibold px-6 py-3 rounded-lg hover:bg-gray-50 transition text-center">ë‹¤ë¥¸ ì§€ì—­ ë¶„ì„</a>'
    +'</div></div>';
}

function generateReport(code){
  analysisState.generating=true;
  const r=REGIONS.find(x=>x.dong_code===code);
  if(r)renderAnalysisContent(r);
  setTimeout(function(){
    analysisState.generating=false;
    analysisState.generated=true;
    if(r)renderAnalysisContent(r);
  },2000);
}

/* â”€â”€ Init â”€â”€ */
window.addEventListener('hashchange',loadAnalysis);
loadAnalysis();
</script>
</body></html>
