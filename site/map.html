<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ì§€ë„ íƒìƒ‰ â€” ë´íŠ¸ë§µAI ì¹˜ê³¼ê°œì› ì…ì§€ë¶„ì„</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
<script>tailwind.config={theme:{extend:{fontFamily:{sans:['Pretendard Variable','Pretendard','system-ui','sans-serif']}}}}</script>
<style>html{scroll-behavior:smooth}body{font-family:'Pretendard Variable',sans-serif}</style>
</head>
<body class="antialiased bg-white text-gray-900">
<div id="test-banner"></div>
<div id="app-header"></div>

<div class="min-h-[calc(100vh-4rem)] flex flex-col">
<!-- Top Bar -->
<div class="border-b border-gray-100 bg-white px-4 py-3">
<div class="max-w-7xl mx-auto flex flex-col md:flex-row items-start md:items-center gap-3">
<div class="relative flex-1 max-w-md w-full">
<svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
<input type="search" id="map-search" placeholder="ì§€ì—­ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°•ë‚¨êµ¬, íŒêµ)" class="w-full pl-10 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-600 focus:border-transparent outline-none" oninput="renderMap()">
</div>
<div class="flex gap-2 flex-wrap" id="map-filters"></div>
</div>
</div>
<!-- Main -->
<div class="flex-1 flex flex-col lg:flex-row">
<div class="flex-1 bg-gradient-to-br from-blue-50 via-sky-50 to-cyan-50 relative p-6 min-h-[400px]">
<div class="max-w-4xl mx-auto">
<div class="text-center mb-6">
<div class="inline-flex items-center gap-2 bg-green-50 text-green-700 text-xs font-medium px-3 py-1.5 rounded-full mb-2"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> í…ŒìŠ¤íŠ¸ ëª¨ë“œ: 8ê°œ ì§€ì—­ ë°ì´í„° &middot; ëª¨ë“  ê¸°ëŠ¥ ì´ìš© ê°€ëŠ¥</div>
<p class="text-sm text-gray-500 mb-1">ì§€ì—­ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
<p class="text-xs text-gray-400" id="map-count-info"></p>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="map-grid"></div>
<div id="map-empty" class="hidden text-center py-20 text-gray-400"><p class="text-4xl mb-3">ğŸ”</p><p>í•´ë‹¹ ì¡°ê±´ì˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ì–´ë¥¼ ì¡°ì •í•´ ë³´ì„¸ìš”.</p></div>
</div>
</div>
<aside id="map-side" class="w-full lg:w-[420px] border-l border-gray-100 bg-white overflow-y-auto hidden">
<div id="map-side-content"></div>
</aside>
</div>
</div>

<div id="app-footer"></div>
<script src="shared.js"></script>
<script>
initPage('map');

let mapFilter='total';
let mapSelected=null;
const filterLabels={total:'ì¢…í•© ì ìˆ˜',population:'ì¸êµ¬ë°€ë„',competition:'ê²½ìŸê°•ë„',cost:'ì„ëŒ€ë¹„ìš©',access:'ì ‘ê·¼ì„±',growth:'ì„±ì¥ì„±'};

function getFilterScore(r,f){return f==='total'?r.scores.total:r.scores[f]}

function initMapFilters(){
  const filters=[{key:'total',label:'ì¢…í•© ì ìˆ˜'},{key:'population',label:'ì¸êµ¬ë°€ë„'},{key:'competition',label:'ê²½ìŸê°•ë„'},{key:'cost',label:'ì„ëŒ€ë¹„ìš©'},{key:'access',label:'ì ‘ê·¼ì„±'},{key:'growth',label:'ì„±ì¥ì„±'}];
  document.getElementById('map-filters').innerHTML=filters.map(f=>'<button onclick="setMapFilter(\''+f.key+'\')" class="map-filter-btn px-3 py-1.5 rounded-full text-xs font-medium transition '+(mapFilter===f.key?'bg-blue-600 text-white':'bg-gray-100 text-gray-600 hover:bg-gray-200')+'" data-filter="'+f.key+'">'+f.label+'</button>').join('');
}

function setMapFilter(f){mapFilter=f;initMapFilters();renderMap()}

function renderMap(){
  const search=(document.getElementById('map-search').value||'').trim();
  let sorted=[...REGIONS].filter(r=>r.dong.includes(search)||r.sigungu.includes(search)||r.sido.includes(search)).sort((a,b)=>getFilterScore(b,mapFilter)-getFilterScore(a,mapFilter));

  document.getElementById('map-count-info').innerHTML='í˜„ì¬ '+sorted.length+'ê°œ ì§€ì—­ ë°ì´í„° | ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬: <span class="font-semibold text-blue-600">'+filterLabels[mapFilter]+'</span>';

  if(sorted.length===0&&search.length>0){
    const safe=search.replace(/'/g,"\\'");
    document.getElementById('map-grid').innerHTML='<div class="col-span-full flex flex-col items-center py-12"><div class="bg-white rounded-2xl shadow-md border-2 border-dashed border-blue-300 p-8 max-w-md w-full text-center"><p class="text-4xl mb-3">ğŸ”</p><p class="text-lg font-bold text-gray-900">ã€Œ'+search+'ã€ ê²€ìƒ‰ ê²°ê³¼</p><p class="text-sm text-gray-500 mt-2">ê¸°ì¡´ ë°ì´í„°ì— ì—†ëŠ” ì§€ì—­ì…ë‹ˆë‹¤.<br>AIê°€ í•´ë‹¹ ì§€ì—­ì˜ ì˜ˆìƒ ë¶„ì„ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><button onclick="analyzeCustomRegion(\''+safe+'\')" class="mt-5 bg-blue-600 text-white font-semibold px-6 py-3 rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-600/20 text-base">ã€Œ'+search+'ã€ AI ë¶„ì„ ì‹œì‘ &rarr;</button><p class="mt-3 text-xs text-gray-400">í…ŒìŠ¤íŠ¸ìš© ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤</p></div></div>';
    document.getElementById('map-empty').classList.add('hidden');
    return;
  }
  if(sorted.length===0){
    document.getElementById('map-grid').innerHTML='';
    document.getElementById('map-empty').classList.remove('hidden');
    return;
  }
  document.getElementById('map-empty').classList.add('hidden');

  document.getElementById('map-grid').innerHTML=sorted.map(r=>{
    const score=getFilterScore(r,mapFilter);
    const sel=mapSelected&&mapSelected.dong_code===r.dong_code;
    return '<button onclick="selectRegion(\''+r.dong_code+'\')" class="text-left bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition border-2 '+(sel?'border-blue-600 shadow-blue-100':'border-transparent')+'"><div class="flex items-start justify-between"><div><p class="text-xs text-gray-400">'+r.sido+' '+r.sigungu+'</p><p class="font-bold text-gray-900 mt-0.5">'+r.dong+'</p></div><div class="px-2 py-1 rounded-lg text-xs font-bold '+getGradeColor(r.grade)+'">'+r.grade+'ë“±ê¸‰</div></div><div class="mt-3 flex items-end justify-between"><div><p class="text-xs text-gray-400">'+(mapFilter==='total'?'ì¢…í•©':filterLabels[mapFilter])+'</p><p class="text-2xl font-bold '+getScoreColor(score)+'">'+score+'ì </p></div><div class="text-right text-xs text-gray-500"><p>ì¸êµ¬ '+(r.population/10000).toFixed(1)+'ë§Œ</p><p>ì¹˜ê³¼ '+r.dental_count+'ê°œ</p></div></div><div class="mt-2 w-full h-1.5 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full '+getScoreBarColor(score)+'" style="width:'+score+'%"></div></div></button>';
  }).join('');
}

function selectRegion(code){
  const r=REGIONS.find(x=>x.dong_code===code);
  if(!r)return;
  mapSelected=r;
  renderMap();
  const side=document.getElementById('map-side');
  side.classList.remove('hidden');

  const axes=[{key:'population',label:'ì¸êµ¬/ìˆ˜ìš”',score:r.scores.population},{key:'competition',label:'ê²½ìŸ í™˜ê²½',score:r.scores.competition},{key:'cost',label:'ë¹„ìš© íš¨ìœ¨',score:r.scores.cost},{key:'access',label:'ì ‘ê·¼ì„±',score:r.scores.access},{key:'growth',label:'ì„±ì¥ì„±',score:r.scores.growth}];

  document.getElementById('map-side-content').innerHTML='<div class="p-6"><button onclick="closeSidePanel()" class="lg:hidden mb-4 text-sm text-gray-500 flex items-center gap-1">&larr; ëª©ë¡ìœ¼ë¡œ</button><div class="flex items-start justify-between"><div><p class="text-sm text-gray-400">'+r.sido+' '+r.sigungu+'</p><h2 class="text-xl font-bold text-gray-900">'+r.dong+'</h2></div><div class="px-3 py-1.5 rounded-lg text-sm font-bold '+getGradeColor(r.grade)+'">'+r.grade+'ë“±ê¸‰</div></div><div class="mt-5 grid grid-cols-2 gap-3"><div class="bg-gray-50 rounded-xl p-3"><p class="text-xs text-gray-500">ê±°ì£¼ì¸êµ¬</p><p class="text-lg font-bold text-gray-900">'+fmt(r.population)+'ëª…</p></div><div class="bg-gray-50 rounded-xl p-3"><p class="text-xs text-gray-500">ì¹˜ê³¼ ìˆ˜</p><p class="text-lg font-bold text-red-500">'+r.dental_count+'ê°œ</p></div><div class="bg-gray-50 rounded-xl p-3"><p class="text-xs text-gray-500">ì¸êµ¬ë‹¹ ì¹˜ê³¼</p><p class="text-lg font-bold text-gray-900">1:'+fmt(r.pop_per_clinic)+'</p></div><div class="bg-gray-50 rounded-xl p-3"><p class="text-xs text-gray-500">í‰ê·  ì„ëŒ€ë£Œ</p><p class="text-lg font-bold text-gray-900">'+r.avg_rent_pyeong+'ë§Œ/í‰</p></div></div><div class="mt-5 bg-blue-50 rounded-xl p-5 text-center"><p class="text-sm text-blue-600 font-medium">ì¢…í•© ì…ì§€ ì ìˆ˜</p><p class="text-5xl font-bold mt-1 '+getScoreColor(r.scores.total)+'">'+r.scores.total+'</p><p class="text-sm text-blue-500 mt-1">'+r.grade+'ë“±ê¸‰ &middot; '+(r.scores.total>=80?'ìš°ìˆ˜':r.scores.total>=70?'ì–‘í˜¸':r.scores.total>=60?'ë³´í†µ':'ì£¼ì˜ í•„ìš”')+'</p></div><div class="mt-5"><h3 class="font-bold text-sm text-gray-700 mb-3">5ì¶• ìƒì„¸ ì ìˆ˜</h3><div class="space-y-3">'+axes.map(a=>'<div><div class="flex items-center justify-between mb-1"><span class="text-sm text-gray-600">'+a.label+'</span><span class="text-sm font-bold '+getScoreColor(a.score)+'">'+a.score+'ì </span></div><div class="w-full h-2 bg-gray-100 rounded-full overflow-hidden"><div class="h-full rounded-full transition-all duration-500 '+getScoreBarColor(a.score)+'" style="width:'+a.score+'%"></div></div></div>').join('')+'</div></div><div class="mt-5 space-y-2 text-sm"><div class="flex justify-between py-2 border-b border-gray-50"><span class="text-gray-500">ê°€ì¥ ê°€ê¹Œìš´ ì—­</span><span class="font-medium">'+r.subway_station+' ('+r.subway_line+', ë„ë³´ '+r.subway_walk_min+'ë¶„)</span></div><div class="flex justify-between py-2 border-b border-gray-50"><span class="text-gray-500">ì¼ ìœ ë™ì¸êµ¬</span><span class="font-medium">'+fmt(r.daily_floating)+'ëª…</span></div><div class="flex justify-between py-2 border-b border-gray-50"><span class="text-gray-500">ì¸êµ¬ ì¦ê°€ìœ¨ (3ë…„)</span><span class="font-medium '+(r.pop_growth_rate>0?'text-green-600':'text-red-500')+'">'+(r.pop_growth_rate>0?'+':'')+r.pop_growth_rate+'%</span></div><div class="flex justify-between py-2 border-b border-gray-50"><span class="text-gray-500">ìƒê¶Œ ë“±ê¸‰</span><span class="font-medium">'+r.commercial_grade+'ê¸‰</span></div><div class="flex justify-between py-2"><span class="text-gray-500">20~39ì„¸ ë¹„ìœ¨</span><span class="font-medium">'+r.age_20_39_pct+'%</span></div></div><div class="mt-6 space-y-3"><a href="analysis.html#'+(r._generated?'gen:'+encodeURIComponent(r.dong):r.dong_code)+'" class="block w-full bg-blue-600 text-white text-center py-3 rounded-lg font-semibold hover:bg-blue-700 transition">ìƒì„¸ ë¶„ì„ ë³´ê¸° &rarr;</a></div></div>';
}

function closeSidePanel(){
  mapSelected=null;
  document.getElementById('map-side').classList.add('hidden');
  renderMap();
}

function analyzeCustomRegion(name){
  location.href='analysis.html#gen:'+encodeURIComponent(name);
}

initMapFilters();
renderMap();
</script>
</body></html>
